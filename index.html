<!DOCTYPE html>
 <html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>E-book Interativo: Acesso Seguro</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Roboto+Mono:wght@400;700&family=Poppins:wght@600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script type="module">
  // Importa as funções necessárias dos SDKs do Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  // --- Configuração do Firebase com as suas chaves ---
  const firebaseConfig = {
  apiKey: "AIzaSyB3xbnaVIViIX0-WvZTA7KUkYxKpH-fqPs",
  authDomain: "ebookxtrader.firebaseapp.com",
  projectId: "ebookxtrader",
  storageBucket: "ebookxtrader.appspot.com",
  messagingSenderId: "682023817418",
  appId: "1:682023817418:web:1eeba2841ae553e2716433"
  };

  // Inicializa o Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // --- LÓGICA DE AUTENTICAÇÃO ---
  const loginScreen = document.getElementById('login-screen');
  const ebookContent = document.getElementById('ebook-content');
  const userEmailDisplay = document.getElementById('user-email');
  const signOutButton = document.getElementById('sign-out-button');
  const mobileAuthContainer = document.getElementById('mobile-auth-container');
  const mobileUserEmailDisplay = document.getElementById('mobile-user-email');
  const mobileSignOutButton = document.getElementById('mobile-sign-out-button');
  
  const emailInput = document.getElementById('email-input');
  const passwordInput = document.getElementById('password-input');
  const signInButton = document.getElementById('sign-in-button');
  const forgotPasswordLink = document.getElementById('forgot-password-link');
  const messageElement = document.getElementById('message');

  signInButton.addEventListener('click', () => {
    const email = emailInput.value;
    const password = passwordInput.value;
    messageElement.style.display = 'none';

    signInWithEmailAndPassword(auth, email, password)
      .then((userCredential) => {
        console.log('Login efetuado com sucesso!', userCredential.user);
      })
      .catch((error) => {
        messageElement.textContent = `Erro ao entrar: ${error.message}`;
        messageElement.className = 'message error';
        messageElement.style.display = 'block';
      });
  });
  
  forgotPasswordLink.addEventListener('click', (e) => {
    e.preventDefault();
    const email = emailInput.value;
    messageElement.style.display = 'none';

    if (!email) {
      messageElement.textContent = 'Por favor, insira o seu e-mail para redefinir a senha.';
      messageElement.className = 'message error';
      messageElement.style.display = 'block';
      return;
    }

    sendPasswordResetEmail(auth, email)
      .then(() => {
        messageElement.textContent = 'E-mail de redefinição enviado! Verifique a sua caixa de entrada.';
        messageElement.className = 'message success';
        messageElement.style.display = 'block';
      })
      .catch((error) => {
        messageElement.textContent = `Erro ao enviar e-mail: ${error.message}`;
        messageElement.className = 'message error';
        messageElement.style.display = 'block';
      });
  });

  function handleSignOut() {
      signOut(auth).then(() => {
        console.log('Logout efetuado com sucesso.');
      }).catch((error) => {
        console.error('Erro ao fazer logout:', error);
      });
  }

  signOutButton.addEventListener('click', handleSignOut);
  mobileSignOutButton.addEventListener('click', handleSignOut);

  onAuthStateChanged(auth, (user) => {
    const body = document.body;
    if (user) {
      loginScreen.style.display = 'none';
      ebookContent.style.display = 'block';
      
      userEmailDisplay.textContent = user.email;
      mobileUserEmailDisplay.textContent = user.email;
      
      body.classList.remove('no-scroll', 'login-view');
      body.classList.add('app-view');
      
      if (!window.ebookScriptsInitialized) {
        initializeEbookScripts();
        window.ebookScriptsInitialized = true;
      }
    } else {
      loginScreen.style.display = 'flex';
      ebookContent.style.display = 'none';
      
      body.classList.add('no-scroll', 'login-view');
      body.classList.remove('app-view', 'sidebar-open');
      window.ebookScriptsInitialized = false;
    }
  });
  
  // --- SCRIPTS DO E-BOOK E CHATBOT (EXECUTADOS APÓS LOGIN) ---
  function initializeEbookScripts() {
    console.log("Scripts do e-book e chatbot inicializados!");

    // --- LÓGICA DO MENU RESPONSIVO ---
    const menuToggle = document.getElementById('menu-toggle');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    const body = document.body;

    function closeMenu() {
        body.classList.remove('sidebar-open');
    }

    menuToggle.addEventListener('click', () => {
        body.classList.toggle('sidebar-open');
    });

    overlay.addEventListener('click', closeMenu);

    sidebar.querySelectorAll('nav a').forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const targetId = link.getAttribute('href');
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                if (targetElement.tagName === 'DETAILS') {
                    targetElement.open = true;
                } else if (targetElement.closest('details')) {
                    targetElement.closest('details').open = true;
                }
                targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            closeMenu();
        });
    });
    
    // --- LÓGICA DO ACCORDION ---
    function setupAccordion(containerSelector) {
        const detailsElements = document.querySelectorAll(containerSelector);
        detailsElements.forEach(details => {
            details.addEventListener('toggle', () => {
                if (details.open) {
                    detailsElements.forEach(otherDetails => {
                        if (otherDetails !== details && otherDetails.parentElement === details.parentElement) {
                            otherDetails.removeAttribute('open');
                        }
                    });
                }
            });
        });
    }
    setupAccordion('.content-section-details');
    setupAccordion('.sub-topic-details');
    setupAccordion('.quiz-container > details');
    
    document.querySelectorAll('.video-embed-container').forEach(container => {
      container.addEventListener('click', () => {
        const videoId = container.getAttribute('data-video-id');
        const iframeHtml = `<div class="video-player-wrapper"><iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`;
        container.innerHTML = iframeHtml;
      }, { once: true });
    });

    const quiz = {
      americano: { questions: [ { q: "Qual índice representa as 500 maiores empresas dos EUA?", a: ["Nasdaq Composite", "Nasdaq-100", "S&P 500", "Dow Jones", "Russell 2000"], correct: 2 }, { q: "O que é o Nasdaq-100?", a: ["Índice com ações da NYSE", "Índice focado apenas em bancos", "Índice das 500 maiores empresas", "Índice das 100 maiores empresas não financeiras da Nasdaq", "Índice de commodities"], correct: 3 }, { q: "Qual é a principal vantagem de operar no mercado americano?", a: ["Isenção de impostos", "Ganhos em dólar e maior liquidez", "Custos operacionais mais altos", "Menor volatilidade", "Ausência de risco cambial"], correct: 1 }, { q: "O que é o USATEC/US100?", a: ["CFD que representa o índice Nasdaq-100", "Um ETF brasileiro", "Índice de petróleo americano", "Ações da Tesla", "Índice do setor bancário dos EUA"], correct: 0 }, { q: "O que é o spread?", a: ["Comissão da corretora", "Taxa fixa de operação", "Diferença entre preço de compra e venda", "Lucro líquido da operação", "Valor da margem"], correct: 2 }, { q: "Quais ativos são mais negociados nos EUA?", a: ["Ações da B3", "ETFs europeus", "Commodities brasileiras", "Nasdaq, Bitcoin, Ouro, EUR/USD", "Fundos de pensão"], correct: 3 }, { q: "Qual a plataforma citada para operar nos EUA com suporte em português?", a: ["MetaTrader 4", "BlackArrow via ZeroMarkets", "Profit Pro", "XP Trader", "Binance"], correct: 1 }, { q: "O que é FOMC?", a: ["Índice de ações", "Comitê Federal de Mercado Aberto do Fed", "Exchange de criptomoedas", "Agência de rating", "Plataforma de negociação"], correct: 1 }, { q: "Quais são os horários de maior liquidez no mercado americano (horário de Brasília)?", a: ["8h às 9h", "12h às 14h", "10h30 às 12h e 15h30 às 17h", "18h às 20h", "22h às 0h"], correct: 2 }, { q: "O que indica o CPI americano?", a: ["Crescimento do PIB", "Desemprego", "Inflação ao consumidor", "Balança comercial", "Política monetária"], correct: 2 } ] },
      brasileiro: { questions: [ { q: "O que é a B3?", a: ["Agência de regulação de bancos", "Bolsa oficial de valores do Brasil", "Empresa de investimentos em petróleo", "Banco Central", "Fundo imobiliário"], correct: 1 }, { q: "O que o Ibovespa representa?", a: ["Taxa Selic", "Principais ações da B3", "Moeda do Brasil", "Preço do dólar futuro", "PIB nacional"], correct: 1 }, { q: "O que é o contrato WIN?", a: ["Ação da Petrobras", "Minicontrato do índice Bovespa", "ETF de commodities", "Fundo de dividendos", "Título do Tesouro"], correct: 1 }, { q: "O que é o contrato WDO?", a: ["Minicontrato da Vale", "Ação do dólar", "Minicontrato do dólar", "Fundo cambial", "ETF internacional"], correct: 2 }, { q: "Qual é a função das médias móveis?", a: ["Calcular o IR", "Suavizar o preço e indicar tendência", "Medir liquidez", "Avaliar spread", "Mostrar a margem exigida"], correct: 1 }, { q: "O que representa o índice IDIV?", a: ["Índice de empresas pequenas", "Lucros do setor de energia", "Empresas com bom histórico de dividendos", "Índice de ações do exterior", "Carteira teórica de fundos"], correct: 2 }, { q: "O que é um stop-loss técnico?", a: ["Ordem para encerrar uma operação com base em análise gráfica", "Ordem para realizar lucro", "Alvo de entrada", "Média móvel de reversão", "Indicador de volume"], correct: 0 }, { q: "Qual plataforma é mais utilizada para operar na B3?", a: ["Binance", "Profit Pro", "BlackArrow", "MetaTrader 4", "Trust Wallet"], correct: 1 }, { q: "O que significa operar vendido?", a: ["Comprar com alavancagem", "Investir em renda fixa", "Apostar na queda do ativo", "Vender ações físicas", "Vender derivativos em carteira"], correct: 2 }, { q: "Qual o valor médio de stop no mini índice?", a: ["500 pontos", "150 a 200 pontos", "10 pontos", "300 a 400 pontos", "20 pontos"], correct: 1 } ] },
      cripto: { questions: [ { q: "O que são criptomoedas?", a: ["Moedas físicas com lastro em ouro", "Ativos digitais descentralizados baseados em blockchain", "Cartões pré-pagos internacionais", "Ações de empresas de tecnologia", "Moedas do governo digital"], correct: 1 }, { q: "Qual a principal função do Bitcoin?", a: ["Moeda nacional de El Salvador", "Reserva de valor descentralizada", "Gateway de pagamentos", "Token da Ethereum", "Moeda para jogos"], correct: 1 }, { q: "Quem é Satoshi Nakamoto?", a: ["CEO da Binance", "Criador do Bitcoin (identidade desconhecida)", "Regra de consenso", "Dono da blockchain", "Fundador da Coinbase"], correct: 1 }, { q: "O que é blockchain?", a: ["Banco de dados público e imutável que registra transações", "Sistema bancário europeu", "Moeda de jogos online", "Software de análise gráfica", "Rede de IPFS"], correct: 0 }, { q: "O que é Proof of Work?", a: ["Modo de converter real em cripto", "Mecanismo de validação via poder computacional", "Prova de transação digital", "Sistema de auditoria bancária", "Protocolo de recuperação de senha"], correct: 1 }, { q: "O que significa “Not your keys, not your coins”?", a: ["Seu saldo está sempre em blockchain", "Se você não tem a chave privada, não controla seus criptoativos", "Todas as chaves são públicas", "Frase usada por exchanges", "Significa backup de carteira"], correct: 1 }, { q: "O que é uma hot wallet?", a: ["Carteira conectada à internet", "Cold wallet com backup", "Plataforma de mineração", "Exchange de criptomoedas", "Dispositivo físico"], correct: 0 }, { q: "Qual a principal stablecoin do mercado?", a: ["Bitcoin", "Ethereum", "Tether (USDT)", "Litecoin", "Solana"], correct: 2 }, { q: "Como a Receita Federal trata as criptomoedas no Brasil?", a: ["Como moeda estrangeira", "Como bens ou direitos que devem ser declarados", "Como renda variável", "Como isentas de tributos", "Como previdência privada"], correct: 1 }, { q: "O que é uma DAO?", a: ["Exchange descentralizada", "Organização autônoma gerida por contratos inteligentes", "Nome da blockchain da Ethereum", "Protocolo de NFT", "Carteira virtual multichave"], correct: 1 } ] }
    };
    
    document.querySelectorAll('.quiz-form').forEach(form => {
        const quizId = form.id.split('-')[1];
        const quizData = quiz[quizId];
    
        if (!quizData) {
            return;
        }
    
        const questionsWrapper = form.querySelector('.questions-wrapper');
        const resultDiv = form.querySelector('.quiz-result');
        
        if (questionsWrapper) {
            questionsWrapper.innerHTML = '';
            quizData.questions.forEach((item, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'quiz-question';
                questionDiv.innerHTML = `<p>${index + 1}. ${item.q}</p>`;
                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'quiz-options';
                item.a.forEach((option, optionIndex) => {
                    const label = document.createElement('label');
                    label.innerHTML = `<input type="radio" name="question${index}" value="${optionIndex}"> ${option}`;
                    optionsDiv.appendChild(label);
                });
                questionDiv.appendChild(optionsDiv);
                questionsWrapper.appendChild(questionDiv);
            });
        }
    
        form.addEventListener('submit', e => {
            e.preventDefault();
            let score = 0;
            const totalQuestions = quizData.questions.length;
            quizData.questions.forEach((item, index) => {
                const selected = form.querySelector(`input[name="question${index}"]:checked`);
                const labels = form.querySelectorAll(`input[name="question${index}"]`);
                labels.forEach(label => {
                    label.parentElement.classList.remove('correct', 'incorrect');
                });
                if (selected) {
                    const answer = parseInt(selected.value);
                    const correctIndex = item.correct;
                    if (answer === correctIndex) {
                        score++;
                        selected.parentElement.classList.add('correct');
                    } else {
                        selected.parentElement.classList.add('incorrect');
                        labels[correctIndex].parentElement.classList.add('correct');
                    }
                }
            });
            if(resultDiv) {
                resultDiv.innerHTML = `Você acertou ${score} de ${totalQuestions} questões!`;
                resultDiv.style.color = score > totalQuestions / 2 ? 'var(--success-color)' : 'var(--danger-color)';
            }
        });
    });

    // --- Lógica do Chatbot ---
    const chatFab = document.getElementById('chat-fab');
    const chatPopup = document.getElementById('chat-popup');
    const closeChatBtn = document.getElementById('close-chat');
    
    chatFab.addEventListener('click', () => {
        chatPopup.classList.add('show-chat');
        chatFab.style.display = 'none';
    });
    closeChatBtn.addEventListener('click', () => {
        chatPopup.classList.remove('show-chat');
        chatFab.style.display = 'flex';
    });

    const chatbotContainer = document.getElementById('chatbot-container');
    const themeSelectionDiv = document.getElementById('theme-selection');
    const chatWindowDiv = document.getElementById('chat-window');
    const themeButtons = document.querySelectorAll('.theme-btn');
    const backBtn = document.getElementById('chatbot-back-btn');
    const chatTitle = document.getElementById('chatbot-title');
    const chatMessages = document.getElementById('chatbot-messages');
    const chatInput = document.getElementById('chatbot-input');
    const sendBtn = document.getElementById('chatbot-send-btn');

    let currentTheme = null;

    // --- Lógica da IA do Gemini ---
    const API_KEY = "AIzaSyBrBfHkU9wpED4nvWGN0R-mgYtzcusDnBU";
    let genAI, model;

    if (API_KEY) {
        try {
            genAI = window.genAI;
            model = window.geminiModel;
        } catch (error) {
            console.error("Erro ao inicializar a API do Gemini. Verifique sua chave.", error);
            genAI = null;
            model = null;
        }
    } else {
        console.warn("A chave da API do Gemini não foi fornecida. O chatbot usará apenas a base de conhecimento local.");
    }
    
    const knowledgeBase = {
        "Criptoativos": {
            "O que são criptomoedas?": "➡ Ativos digitais descentralizados que utilizam a tecnologia blockchain para garantir segurança, transparência e independência de intermediários.",
            "O que é Bitcoin?": "➡ Primeira criptomoeda criada, em 2008, por Satoshi Nakamoto como resposta à crise financeira.",
            "Quem é Satoshi Nakamoto?": "➡ Pseudônimo do criador do Bitcoin; sua identidade verdadeira é desconhecida.",
            "O que é blockchain?": "➡ Cadeia de blocos que armazena transações de forma imutável e distribuída.",
            "O que é Proof of Work?": "➡ Mecanismo de validação que exige poder computacional para resolver problemas matemáticos.",
            "O que é Proof of Stake?": "➡ Validação por meio de travamento de moedas como garantia, consumindo menos energia.",
            "Qual a principal função da blockchain?": "➡ Registrar transações de forma pública, segura e sem possibilidade de alteração.",
            "O que é mineração?": "➡ Processo de validar transações e gerar novos blocos, recebendo recompensa.",
            "O que é halving?": "➡ Redução periódica pela metade da recompensa de mineração do Bitcoin.",
            "Por que o Bitcoin é escasso?": "➡ Porque terá no máximo 21 milhões de unidades em circulação até 2140.",
            "O que é o Pizza Day?": "➡ Primeiro uso real do Bitcoin, em 2010, quando 10.000 BTC foram trocados por duas pizzas.",
            "O que são altcoins?": "➡ Todas as criptomoedas que não são o Bitcoin.",
            "O que é market cap em cripto?": "➡ Valor de mercado total de uma cripto: preço × número de moedas em circulação.",
            "Qual o papel do Ethereum?": "➡ Plataforma para criação de contratos inteligentes e aplicativos descentralizados.",
            "O que são smart contracts?": "➡ Contratos autoexecutáveis com regras programadas na blockchain.",
            "O que são tokens?": "➡ Representações digitais de ativos ou utilidades criados em redes como Ethereum.",
            "O que são NFTs?": "➡ Tokens não fungíveis que representam itens únicos como obras digitais.",
            "O que é DeFi?": "➡ Finanças descentralizadas: serviços financeiros sem intermediários, usando blockchain.",
            "O que é uma wallet?": "➡ Carteira digital que armazena suas chaves privadas e acesso aos criptoativos.",
            "O que é uma hot wallet?": "➡ Carteira conectada à internet, prática mas mais vulnerável.",
            "O que é uma cold wallet?": "➡ Carteira offline, mais segura, ideal para longo prazo.",
            "Exemplos de cold wallets?": "➡ Ledger e Trezor.",
            "Exemplos de hot wallets?": "➡ MetaMask, Trust Wallet, Binance Wallet.",
            "O que é chave privada?": "➡ Código secreto que dá acesso total aos seus criptoativos.",
            "O que significa “Not your keys, not your coins”?": "➡ Se você não tem a chave privada, você não tem controle sobre os ativos.",
            "O que é autocustódia?": "➡ Quando o próprio usuário é responsável por guardar sua chave privada.",
            "O que é custódia de terceiros?": "➡ Quando uma instituição (como exchange) armazena sua chave privada.",
            "Quais os riscos da autocustódia?": "➡ Perda da frase de recuperação implica perda total dos ativos.",
            "Quais os riscos da custódia de terceiros?": "➡ Falência da empresa, hackeamento ou congelamento de contas.",
            "O que são exchanges?": "➡ Plataformas onde se compram, vendem e negociam criptomoedas.",
            "Quais as principais exchanges?": "➡ Binance, Coinbase, Kraken, Gemini, OKX, entre outras.",
            "Como funciona a Binance?": "➡ Exchange global com 2FA, cold wallets e fundo de proteção SAFU.",
            "O que é SAFU?": "➡ Fundo de segurança da Binance para proteger usuários contra incidentes.",
            "O que é CoinMarketCap?": "➡ Site que exibe preços, capitalização e volume de negociação de criptoativos.",
            "Quais são os 4 principais ativos cripto?": "➡ Bitcoin (BTC), Ethereum (ETH), Tether (USDT) e Solana (SOL).",
            "Qual a função do Tether (USDT)?": "➡ Ser uma stablecoin pareada ao dólar, usada para evitar volatilidade.",
            "Qual a função da Solana?": "➡ Blockchain de alta escalabilidade, taxas baixas e foco em dApps e NFTs.",
            "Qual o market cap atual do Bitcoin?": "➡ Aproximadamente US$ 2 trilhões (dados de 2024).",
            "Qual o volume de negociação diário do Ethereum?": "➡ Cerca de US$ 13 bilhões (dados de 2024).",
            "O que é frase de recuperação?": "➡ Sequência de 12 a 24 palavras que permite restaurar uma carteira.",
            "O que acontece se eu perder a frase de recuperação?": "➡ Você perde o acesso aos seus ativos permanentemente.",
            "É seguro deixar cripto em exchange?": "➡ Apenas por curto prazo; não é recomendado como armazenamento principal.",
            "O que é staking?": "➡ Travamento de criptos para receber recompensas e validar transações (Proof of Stake).",
            "Quais taxas existem em exchanges?": "➡ Taxa de negociação, de saque e, em alguns casos, de custódia.",
            "Como acompanhar preços de criptos em tempo real?": "➡ Através de sites como CoinMarketCap ou CoinGecko.",
            "Como declarar criptomoedas no Brasil?": "➡ Como “bens e direitos” na declaração do imposto de renda.",
            "Como calcular ganho de capital com cripto?": "➡ É a diferença entre o valor de venda e o de compra da moeda.",
            "Qual a alíquota de imposto sobre cripto?": "➡ De 15% a 22,5%, conforme o ganho obtido.",
            "Quando pagar imposto sobre cripto?": "➡ Quando as vendas superam R$ 35 mil no mês com lucro.",
            "Qual o melhor tipo de wallet para iniciantes?": "➡ Hot wallets como Trust Wallet e MetaMask pela praticidade, mas com pequenos valores.",
            "Como abrir uma conta na Binance?": '➡ Acesse o site https://www.binance.com, clique em "Registrar", insira seu e-mail e crie uma senha segura. Em seguida, confirme o código enviado por e-mail e conclua o processo de verificação de identidade (KYC).',
            "Quais documentos são necessários para abrir conta em uma exchange?": "➡ Normalmente, são exigidos: documento de identidade com foto (CNH, RG ou passaporte), comprovante de residência recente e, às vezes, uma selfie para validação facial.",
            "O que é o processo KYC nas exchanges?": "➡ KYC (Know Your Customer) é a verificação de identidade do cliente exigida por lei. Envolve a validação de documentos e informações pessoais para prevenir lavagem de dinheiro e fraudes.",
            "Por que a Binance solicita selfie e documento com foto?": "➡ Para confirmar que o titular da conta é a mesma pessoa do documento enviado, aumentando a segurança contra fraudes.",
            "É possível abrir conta na Binance apenas com CPF?": "➡ Não. É necessário fornecer documento com foto (como RG ou CNH) e fazer verificação facial, além de informar o CPF para brasileiros.",
            "Como ativar a autenticação em dois fatores (2FA) na Binance?": "➡ No menu de segurança da conta, ative o 2FA usando Google Authenticator ou SMS. Isso adiciona uma camada extra de proteção ao login e às transações.",
            "Quais métodos de depósito posso usar para comprar criptomoedas?": "➡ É possível usar PIX, transferências bancárias via parceiros P2P da Binance, ou cartão de crédito, dependendo da região e da verificação da conta.",
            "Quanto tempo demora para aprovar uma conta na Binance?": "➡ Normalmente de alguns minutos a poucas horas após o envio correto de todos os documentos solicitados.",
            "É possível comprar criptomoedas sem passar por verificação de identidade?": "➡ Não. Para utilizar todos os serviços da Binance e acessar limites maiores de saque e depósito, é obrigatório passar pela verificação KYC.",
            "Posso usar a Binance pelo celular?": "➡ Sim. A Binance possui um aplicativo completo disponível para Android e iOS, com todos os recursos da versão web."
        },
        "Mercado Brasileiro": {
            "O que é a B3?": "➡ Bolsa de Valores oficial do Brasil.",
            "O que é o Ibovespa?": "➡ Principal índice da B3, com ações mais negociadas.",
            "O que é o IBrX100?": "➡ Índice com as 100 ações mais líquidas do mercado brasileiro.",
            "O que é o IDIV?": "➡ Índice das ações com maior pagamento de dividendos.",
            "O que é o SMLL?": "➡ Índice das small caps, empresas de menor capitalização.",
            "O que é o WIN?": "➡ Minicontrato futuro do índice Ibovespa.",
            "O que é o WDO?": "➡ Minicontrato futuro do dólar.",
            "O que é minicontrato?": "➡ Versão fracionada de contratos futuros.",
            "Como operar na B3?": "➡ Abra conta em corretora, instale uma plataforma e envie recursos.",
            "O que é o Profit Pro?": "➡ Plataforma popular no Brasil para operações na bolsa.",
            "Como usar médias móveis na B3?": "➡ Para identificar tendência, zonas de suporte e resistência.",
            "O que é análise técnica?": "➡ Estudo do comportamento do preço com base em gráficos.",
            "O que é stop-loss técnico?": "➡ Ponto de saída calculado com base em estruturas gráficas.",
            "Como configurar o Profit?": "➡ Adicione gráficos, indicadores e personalize conforme seu estilo.",
            "O que é candle de alta?": "➡ Quando o preço de fechamento é maior que o de abertura.",
            "O que são pavios dos candles?": "➡ Representam a máxima e mínima do período.",
            "O que é pullback na B3?": "➡ Retração antes da continuação da tendência.",
            "Qual a margem mínima para operar WIN?": "➡ Em torno de R$ 100 a R$ 300 por contrato.",
            "O que é gerenciamento de risco?": "➡ Estratégia de controle de perdas e tamanho de lote.",
            "O que é perfil de investidor?": "➡ Classificação de risco: conservador, moderado, agressivo.",
            "O que é suitability?": "➡ Questionário obrigatório para operar na bolsa.",
            "Como abrir conta na Genial?": "➡ Preencha cadastro, envie documentos e aguarde validação.",
            "Como declarar lucro na B3?": "➡ Informar operações no IR usando programa da Receita.",
            "O que são small caps?": "➡ Empresas com menor valor de mercado, geralmente mais voláteis.",
            "O que são blue chips?": "➡ Ações de empresas grandes, consolidadas e com alta liquidez.",
            "Qual horário da B3?": "➡ 10h às 17h para ações; minicontratos abrem às 9h.",
            "Como operar vendido?": "➡ Alugue ações e venda esperando comprar mais barato depois.",
            "O que é scalping?": "➡ Estratégia de curtíssimo prazo com lucros rápidos.",
            "O que é swing trade?": "➡ Operações que duram de alguns dias a semanas.",
            "O que é day trade?": "➡ Compra e venda no mesmo dia.",
            "Como evitar overtrading?": "➡ Estabeleça limite de operações por dia.",
            "O que é stop diário?": "➡ Limite de perda permitido por dia.",
            "O que é o gráfico de 5 minutos?": "➡ Mostra o comportamento do preço em cada intervalo de 5 minutos.",
            "O que é candle de reversão?": "➡ Indica possível mudança na direção da tendência.",
            "O que é análise fundamentalista?": "➡ Avaliação de empresas com base em indicadores financeiros.",
            "Qual a melhor corretora para iniciantes?": "➡ A Genial Investimentos é a melhor corretora para iniciantes, especialmente por ser parceira da equipe Xtraders, oferecendo conta gratuita, suporte personalizado e acesso liberado ao Profit Pro para quem opera minicontratos.",
            "Como simular operações na B3?": "➡ Use conta demo em plataformas como Profit ou Tryd.",
            "Como pagar menos taxa na B3?": "➡ Negocie pacotes com sua corretora ou opere com volume maior.",
            "O que é lote padrão?": "➡ Quantidade mínima de ações para negociação no mercado à vista.",
            "O que é fracionário?": "➡ Permite comprar menos que um lote padrão (ex: 1 ação).",
            "O que são indicadores técnicos?": "➡ RSI, MACD, Médias Móveis, Bandas de Bollinger.",
            "O que é book de ofertas?": "➡ Lista de ordens de compra e venda em tempo real.",
            "Como usar o Times & Trades?": "➡ Mostra todas as negociações executadas, útil para tape reading.",
            "O que é tape reading?": "➡ Técnica de leitura de fluxo de ordens para antecipar movimentos.",
            "Qual o risco de operar alavancado?": "➡ Perdas rápidas e potencial de prejuízos acima do capital investido.",
            "Qual a diferença entre ações ON e PN?": "➡ ON têm direito a voto; PN têm preferência em dividendos.",
            "O que é payout?": "➡ Porcentagem do lucro distribuído aos acionistas.",
            "O que é dividend yield?": "➡ Retorno percentual pago em dividendos sobre o valor da ação.",
            "O que são JCP?": "➡ Juros sobre capital próprio, forma de remuneração aos sócios.",
            "O que é split de ações?": "➡ Desdobramento que aumenta a quantidade de ações sem alterar o valor investido.",
            "Como abrir uma conta na Genial Investimentos?": "➡ Acesse o site https://genialinvestimentos.com.br, clique em “Abra sua conta”, preencha seus dados pessoais, envie os documentos solicitados e aguarde a validação.",
            "Quais documentos são necessários para abrir a conta?": "➡ Documento com foto (CNH ou RG), CPF e comprovante de residência recente (até 90 dias), todos em nome do titular da conta.",
            "A abertura de conta na Genial é gratuita?": "➡ Sim, a abertura é 100% gratuita e sem exigência de depósito mínimo inicial.",
            "Quanto tempo demora para a conta ser aprovada?": "➡ A validação costuma ocorrer em até 2 dias úteis após o envio de todos os documentos corretamente.",
            "Posso abrir a conta pelo celular?": "➡ Sim. Você pode abrir a conta tanto pelo site oficial quanto pelo aplicativo da Genial disponível na Play Store ou App Store.",
            "O que é o Suitability da Genial?": "➡ É um questionário obrigatório que define seu perfil de investidor (conservador, moderado ou arrojado) com base em suas respostas sobre renda, objetivos e tolerância ao risco.",
            "Qual perfil é necessário para operar minicontratos na B3?": "➡ O perfil Arrojado é o recomendado e exigido para quem deseja operar minicontratos como WIN (mini índice) e WDO (mini dólar).",
            "Preciso ser maior de idade para abrir conta?": "➡ Sim. A Genial exige que o titular da conta tenha pelo menos 18 anos completos.",
            "Como faço o primeiro depósito na Genial?": "➡ Após aprovação da conta, você pode transferir valores via PIX ou TED de uma conta bancária de mesma titularidade (mesmo CPF).",
            "Qual é o valor mínimo para operar na Genial Investimentos?": "➡ Para operar minicontratos, o valor mínimo recomendado por contrato é de R$ 100 a R$ 300, dependendo da margem exigida no dia.",
            "É preciso assinar contrato físico para abrir conta?": "➡ Não. Todo o processo de abertura é digital, incluindo assinatura eletrônica via plataforma da Genial.",
            "Como preencher os dados corretamente durante o cadastro?": "➡ Tenha em mãos CPF, documento com foto, endereço completo, dados bancários e renda mensal. Evite erros e certifique-se de que os dados estejam atualizados.",
            "O que acontece após a aprovação da conta?": "➡ Você poderá acessar o painel da Genial, transferir recursos, contratar a plataforma Profit Pro e começar a investir ou operar.",
            "A Genial oferece suporte por assessoria?": "➡ Sim. Após abertura da conta, é possível trocar sua assessoria dentro do painel para \"Genial B2B 4\", recomendado para suporte especializado.",
            "A plataforma Profit Pro está incluída na conta?": "➡ Sim. Se você operar pelo menos 1 minicontrato WIN ou WDO por mês, a mensalidade do Profit Pro será isenta."
        },
        "Mercado Americano": {
            "O que é a Nasdaq?": "➡ Bolsa americana focada em empresas de tecnologia.",
            "O que é a NYSE?": "➡ É a Bolsa de Valores de Nova York, voltada para empresas tradicionais e consolidadas.",
            "Qual a diferença entre Nasdaq e NYSE?": "➡ Nasdaq foca em tecnologia; NYSE em setores diversos e empresas estabelecidas.",
            "O que é o índice Nasdaq-100?": "➡ Índice das 100 maiores empresas não financeiras da Nasdaq.",
            "O que é o S&P 500?": "➡ Índice das 500 maiores empresas de capital aberto dos EUA.",
            "O que é o Dow Jones?": "➡ Índice com 30 das maiores e mais tradicionais empresas dos EUA.",
            "O que é o USATEC?": "➡ Nome alternativo para o índice Nasdaq-100 em plataformas de negociação.",
            "Como abrir conta na ZeroMarkets?": "➡ Acesse o site, cadastre-se, envie documentos e preencha o questionário de perfil.",
            "Para que serve o BlackArrow?": "➡ Plataforma de negociação para operar ativos internacionais como Nasdaq e Ouro.",
            "O que é um contrato futuro?": "➡ Acordo para comprar ou vender um ativo em uma data futura a um preço predeterminado.",
            "Como ganhar em dólar operando nos EUA?": "➡ Operando ativos em dólar, com possibilidade de valorização cambial.",
            "Quais ativos são operados nos EUA?": "➡ Nasdaq, Ouro, DAX, EUR/USD, petróleo, entre outros.",
            "O que é o FOMC?": "➡ Comitê que define as taxas de juros nos EUA.",
            "O que é Payroll?": "➡ Relatório de emprego dos EUA, que influencia fortemente o mercado.",
            "Qual a importância do CPI?": "➡ É o índice de inflação ao consumidor e impacta diretamente os juros.",
            "O que é política monetária?": "➡ Conjunto de ações do banco central para controlar a economia.",
            "O que são índices?": "➡ Medidas estatísticas que indicam o desempenho de um grupo de ativos.",
            "Quais as vantagens do mercado americano?": "➡ Alta liquidez, ativos em dólar, menor ruído gráfico.",
            "O que é alavancagem?": "➡ Capacidade de operar com mais dinheiro do que se tem na conta.",
            "O que é o spread?": "➡ Diferença entre o preço de compra e de venda de um ativo.",
            "Como funciona o horário das bolsas?": "➡ Abertura principal às 10h30 (Brasília), fechamento às 17h.",
            "O que é um candle de 5 minutos?": "➡ Cada vela no gráfico representa 5 minutos de negociação.",
            "O que são médias móveis?": "➡ Indicadores de tendência baseados em preços anteriores.",
            "Como usar o gráfico de 60 minutos?": "➡ Para entender a tendência principal antes de operações curtas.",
            "O que é continuidade de tendência?": "➡ Estratégia que segue a direção atual do mercado.",
            "O que é pullback?": "➡ Retração temporária no preço antes da retomada da tendência.",
            "O que é candle gatilho?": "➡ Candle que confirma uma entrada técnica após estrutura formada.",
            "Qual o stop médio no Nasdaq?": "➡ Em torno de 25 pontos por operação.",
            "Qual o stop médio no Ouro?": "➡ Entre 3 e 4 pontos.",
            "O que é o GER40?": "➡ Índice alemão, também chamado de DAX.",
            "Como operar Forex nos EUA?": "➡ Por meio de pares como EUR/USD, usando plataformas internacionais.",
            "Como usar múltiplos tempos gráficos?": "➡ Combine diário, 60m, 15m e 5m para identificar direção clara.",
            "O que é escalonamento de entradas?": "➡ Abertura de posições em diferentes pontos ao longo do movimento.",
            "Como configurar o BlackArrow?": "➡ Importe configurações padrão e adapte médias e gráficos.",
            "Como instalar o BlackArrow?": "➡ Após ativação na corretora, baixe pelo site da ZeroMarkets.",
            "O que é swap?": "➡ Juros pagos ou recebidos ao manter posições abertas de um dia para o outro.",
            "Como o Fed impacta o mercado?": "➡ Suas decisões de juros afetam o dólar e o apetite por risco.",
            "Qual a importância do dólar no mundo?": "➡ Moeda referência global, afeta todos os mercados.",
            "Como operar contratos de petróleo?": "➡ Utilize o XBR/USD ou CFDs de petróleo Brent.",
            "O que é o Nikkei 225?": "➡ Índice da bolsa japonesa, representa empresas do Japão.",
            "Qual o risco de operar nos EUA?": "➡ Alta volatilidade e exposição cambial.",
            "Como calcular o lote ideal?": "➡ Com base no stop técnico e capital disponível.",
            "Como converter dólar para real?": "➡ Multiplique pelo câmbio do dia da operação.",
            "Como saber se um ativo está ruim?": "➡ Presença de ruído e falta de direção clara.",
            "Como evitar overtrading?": "➡ Defina número máximo de operações por dia.",
            "Quais as médias mais comuns?": "➡ 9, 20, 50, 72 e 200 períodos.",
            "Como se proteger no mercado americano?": "➡ Usando stop, limite diário e controle emocional.",
            "Qual o tamanho da conta recomendada?": "➡ Pelo menos US$ 2.000 para operar com margem de segurança.",
            "Como testar estratégia?": "➡ Use conta demo ou simulador com o BlackArrow.",
            "Como acompanhar notícias do mercado?": "➡ Usando o calendário econômico do Investing.com.",
            "Como abrir uma conta na ZeroMarkets para operar nos EUA?": "➡ Acesse o site https://trader.zeromarkets.com/session/signup, insira nome e e-mail, confirme o código enviado e siga as etapas de preenchimento de dados pessoais, envio de documentos e questionário de perfil.",
            "Quais documentos são exigidos na abertura de conta na ZeroMarkets?": "➡ CNH, RG, Passaporte, RNE ou CIE, além de um comprovante de residência recente (em nome do titular e com endereço brasileiro, mesmo que more no exterior).",
            "Qual é o valor mínimo de depósito na ZeroMarkets?": "➡ O depósito mínimo recomendado é de US$ 200 para ativar a isenção da taxa mensal da plataforma BlackArrow.",
            "O que é o código IB e por que ele é importante?": "➡ O código IB (Introducing Broker) identifica a equipe à qual sua conta será vinculada. Para acesso a benefícios como uso gratuito do BlackArrow, o IB correto é: 31439 – TIME XTRADERS.",
            "Como preencher corretamente o questionário de investidor da ZeroMarkets?": "➡ Para acesso completo, recomenda-se:\nQ6: GERAÇÃO DE RENDA\nQ7: ENTRE 3 E 5 ANOS\nQ8: DISPOSTO A RISCOS ELEVADOS\nQ9: COMPRARIA MAIS PARA REDUZIR PREÇO\nQ10–13: EXPERIÊNCIA AVANÇADA\nQ14: DIARIAMENTE",
            "Quanto tempo leva para a conta na ZeroMarkets ser aprovada?": "➡ A aprovação pode ocorrer em poucas horas ou até 2 dias úteis, dependendo da qualidade dos documentos enviados.",
            "Qual a diferença entre conta real e conta demo na ZeroMarkets?": "➡ A conta Real permite operar com capital próprio. A conta Demo oferece saldo simulado para praticar operações e estratégias sem risco real.",
            "Quais ativos posso operar ao abrir conta na ZeroMarkets?": "➡ Índices como US100 (Nasdaq), commodities como ouro (XAU/USD), pares de moedas (EUR/USD), petróleo, Bitcoin e ações globais.",
            "A ZeroMarkets aceita comprovante de residência emitido fora do Brasil?": "➡ Não. Mesmo morando no exterior, é necessário enviar comprovante de endereço emitido no Brasil e em nome do titular.",
            "Como acessar a plataforma BlackArrow após abrir a conta?": "➡ Após aprovação da conta e depósito inicial, acesse a área de downloads no painel da ZeroMarkets e instale o BlackArrow. Você pode importar o layout padrão usado pela equipe Xtraders."
        }
    };
    
    async function getChatbotResponse(theme, question) {
        const themeKB = knowledgeBase[theme];
        
        if (themeKB && themeKB[question]) {
            console.log("Resposta encontrada na base de conhecimento.");
            return themeKB[question];
        }

        if (model) {
            console.log("Não encontrado localmente. Consultando a IA...");
            try {
                const prompt = `Você é um assistente virtual amigável e especialista em finanças, parte de um e-book interativo. O usuário está no tópico '${theme}'. Responda à seguinte pergunta de forma clara, objetiva e concisa, mantendo o tom profissional do e-book: "${question}"`;

                const result = await model.generateContent(prompt);
                const response = await result.response;
                const text = response.text();
                return text;

            } catch (error) {
                console.error("Erro ao contatar a API do Gemini:", error);
                return "Desculpe, estou com um problema para me conectar à minha inteligência. Tente novamente mais tarde.";
            }
        } else {
            return "Não encontrei uma resposta exata para essa pergunta. Por favor, escolha uma das sugestões ou tente uma pergunta diferente. A funcionalidade de IA não está ativa no momento.";
        }
    }

    function addChatMessage(text, sender) {
        const bubble = document.createElement('div');
        bubble.className = `chat-bubble max-w-md md:max-w-lg p-3 rounded-xl ${sender === 'user' ? 'chat-bubble-user self-end bg-blue-600 text-white' : 'chat-bubble-bot self-start bg-gray-700 text-gray-300'}`;
        bubble.textContent = text;
        chatMessages.appendChild(bubble);
        scrollToChatBottom();
    }
    
    function scrollToChatBottom() {
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function removeChatSuggestions() {
        const suggestionContainer = document.getElementById('suggestion-area');
        if (suggestionContainer) {
            suggestionContainer.remove();
        }
    }
    
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function displayChatSuggestions(theme) {
        removeChatSuggestions();
        const allQuestions = Object.keys(knowledgeBase[theme]);
        if (!allQuestions || allQuestions.length === 0) return;
        
        const suggestions = shuffleArray([...allQuestions]).slice(0, 4);

        const suggestionContainer = document.createElement('div');
        suggestionContainer.id = 'suggestion-area';
        suggestionContainer.className = 'suggestion-btn-container flex flex-col items-start self-start space-y-2 mt-2 w-full';

        suggestions.forEach(q => {
            const btn = document.createElement('button');
            btn.className = 'suggestion-btn bg-gray-700 hover:bg-gray-600 text-gray-300 py-2 px-4 rounded-lg text-sm w-full md:w-auto text-left transition-colors';
            btn.textContent = q;
            btn.onclick = () => {
                handleChatSend(q);
            };
            suggestionContainer.appendChild(btn);
        });

        chatMessages.appendChild(suggestionContainer);
        scrollToChatBottom();
    }

    async function handleChatSend(messageText) {
        const userMessage = messageText.trim();
        if (userMessage === '') return;
        
        removeChatSuggestions();
        addChatMessage(userMessage, 'user');
        chatInput.value = '';
        
        const thinkingBubble = document.createElement('div');
        thinkingBubble.className = 'chat-bubble-bot self-start bg-gray-700 text-gray-300';
        thinkingBubble.innerHTML = `<div class="typing-indicator"><span></span><span></span><span></span></div>`;
        chatMessages.appendChild(thinkingBubble);
        scrollToChatBottom();
        
        const botResponse = await getChatbotResponse(currentTheme, userMessage);
        
        thinkingBubble.remove();
        addChatMessage(botResponse, 'bot');
        displayChatSuggestions(currentTheme);
    }

    themeButtons.forEach(button => {
        button.addEventListener('click', () => {
            currentTheme = button.dataset.theme;
            themeSelectionDiv.style.display = 'none';
            chatWindowDiv.style.display = 'flex';
            chatTitle.textContent = currentTheme;
            chatMessages.innerHTML = '';
            addChatMessage("Olá! Sou um assistente com IA. Você pode clicar nas sugestões ou me perguntar qualquer coisa sobre este tópico!", 'bot');
            displayChatSuggestions(currentTheme);
            chatInput.focus();
        });
    });

    backBtn.addEventListener('click', () => {
        chatWindowDiv.style.display = 'none';
        themeSelectionDiv.style.display = 'block';
        currentTheme = null;
    });

    sendBtn.addEventListener('click', () => handleChatSend(chatInput.value));
    chatInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            handleChatSend(chatInput.value);
        }
    });
    
    const profileQuizForm = document.getElementById('profile-quiz-form');
    profileQuizForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const resultDiv = document.getElementById('profile-quiz-result');
        const answers = new FormData(e.target);
        let score = 0;

        for (let value of answers.values()) {
            score += parseInt(value);
        }

        let profile = '', profileDescription = '', profileColorClass = '';

        // Novas faixas de pontuação ajustadas para 10 perguntas
        // Pontuação Mínima: 10 | Pontuação Máxima: 30
        if (score <= 16) { 
            profile = 'Conservador';
            profileDescription = 'Você prioriza a segurança e a preservação do seu capital. Seu foco é evitar perdas, mesmo que isso signifique uma rentabilidade menor. Produtos de baixo risco são os mais indicados para você.';
            profileColorClass = 'profile-conservative';
        } else if (score <= 23) { 
            profile = 'Moderado';
            profileDescription = 'Você busca um equilíbrio entre segurança e rentabilidade. Aceita correr alguns riscos de forma controlada para obter ganhos maiores no médio e longo prazo, diversificando seus investimentos.';
            profileColorClass = 'profile-moderate';
        } else { 
            profile = 'Arrojado';
            profileDescription = 'Você tem alta tolerância ao risco e busca a máxima rentabilidade. Entende que a volatilidade faz parte do processo para alcançar maiores ganhos e está preparado para possíveis perdas no curto prazo.';
            profileColorClass = 'profile-aggressive';
        }
        
        resultDiv.innerHTML = `<h4 class="text-xl font-bold mb-2">Seu Perfil: <span class="${profileColorClass}">${profile}</span></h4><p>${profileDescription}</p>`;
        resultDiv.style.display = 'block';
    });

    document.querySelectorAll('.interactive-checklist').forEach(checklist => {
      const checkboxes = checklist.querySelectorAll('input[type="checkbox"]');
      const progressBar = checklist.querySelector('.progress-bar-fill');
      const totalSteps = checkboxes.length;

      function updateProgress() {
        const checkedSteps = checklist.querySelectorAll('input[type="checkbox"]:checked').length;
        const percentage = (checkedSteps / totalSteps) * 100;
        progressBar.style.width = percentage + '%';
      }

      checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', () => {
          checkbox.closest('label').classList.toggle('completed', checkbox.checked);
          updateProgress();
        });
      });
      
      updateProgress();
    });
  }

  // --- ANIMAÇÃO DE FUNDO GLOBAL ---
    const canvas = document.getElementById('animated-background');
    const ctx = canvas.getContext('2d');
    let particles = [];
    let mouse = { x: null, y: null };

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    resizeCanvas();

    class Particle {
        constructor(x, y, directionX, directionY, size, color) {
            this.x = x;
            this.y = y;
            this.directionX = directionX;
            this.directionY = directionY;
            this.size = size;
            this.color = color;
        }
        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2, false);
            ctx.fillStyle = this.color;
            ctx.fill();
        }
        update() {
            if (this.x > canvas.width || this.x < 0) {
                this.directionX = -this.directionX;
            }
            if (this.y > canvas.height || this.y < 0) {
                this.directionY = -this.directionY;
            }
            this.x += this.directionX;
            this.y += this.directionY;
            this.draw();
        }
    }

    function init() {
        particles = [];
        let numberOfParticles = (canvas.height * canvas.width) / 9000;
        for (let i = 0; i < numberOfParticles; i++) {
            let size = (Math.random() * 2) + 1;
            let x = (Math.random() * ((innerWidth - size * 2) - (size * 2)) + size * 2);
            let y = (Math.random() * ((innerHeight - size * 2) - (size * 2)) + size * 2);
            let directionX = (Math.random() * .4) - .2;
            let directionY = (Math.random() * .4) - .2;
            let color = 'rgba(173, 216, 230, 0.5)';
            particles.push(new Particle(x, y, directionX, directionY, size, color));
        }
    }

    function connect() {
        let opacityValue = 1;
        for (let a = 0; a < particles.length; a++) {
            for (let b = a; b < particles.length; b++) {
                let distance = ((particles[a].x - particles[b].x) * (particles[a].x - particles[b].x))
                             + ((particles[a].y - particles[b].y) * (particles[a].y - particles[b].y));
                if (distance < (canvas.width / 7) * (canvas.height / 7)) {
                    opacityValue = 1 - (distance / 20000);
                    ctx.strokeStyle = `rgba(173, 216, 230, ${opacityValue})`;
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(particles[a].x, particles[a].y);
                    ctx.lineTo(particles[b].x, particles[b].y);
                    ctx.stroke();
                }
            }
        }
    }

    function animate() {
        requestAnimationFrame(animate);
        ctx.clearRect(0, 0, innerWidth, innerHeight);
        for (let i = 0; i < particles.length; i++) {
            particles[i].update();
        }
        connect();
    }
    
    window.addEventListener('resize', () => {
        resizeCanvas();
        init();
    });

    window.addEventListener('mousemove', (event) => {
        mouse.x = event.x;
        mouse.y = event.y;
    });

    init();
    animate();
  </script>
  <style>
  :root {
  --dark-blue: #2c3e50;
  --br-green: #009B3A;
  --br-yellow: #FFDF00;
  --us-blue: #0A3161;
  --us-red: #B31942;
  --crypto-yellow: #F7931A;
  --crypto-black: #333333;
  --glass-bg: rgba(15, 15, 25, 0.5);
  --glass-border: rgba(255, 255, 255, 0.1);
  --text-light: #f0f0f0;
  --success-color: #28a745;
  --danger-color: #dc3545;
  --warning-color: #ffc107;
  --gemini-purple: #8e44ad;
  --header-height: 60px;
  --sidebar-width: 280px;
  }
  html { 
  scroll-behavior: smooth; 
  }
  
  #animated-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
  }

  body {
    font-family: 'Inter', Arial, sans-serif;
    margin: 0;
    color: var(--text-light);
    background-color: #020412;
    display: flex; /* Mantido para centralizar a tela de login */
    justify-content: center;
    align-items: center;
  }
  body.login-view {
    height: 100vh;
    overflow: hidden;
  }
  body.app-view {
    display: block; /* Altera para block quando o app está visível */
  }
  .no-scroll {
      overflow: hidden;
  }
  body.sidebar-open {
      overflow: hidden;
  }

  #login-screen {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
  width: 100%;
  z-index: 100;
  }
  .login-box {
  background-color: rgba(0,0,0,0.5);
  padding: 40px;
  border-radius: 15px;
  text-align: center;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.2);
  width: 100%;
  max-width: 400px;
  box-sizing: border-box;
  }
  .login-box h2 { margin-top: 0; font-size: 1.8em; }
  .login-box p { margin-bottom: 20px; color: #ccc; }
  .login-box input {
  width: 100%;
  padding: 12px;
  margin-bottom: 15px;
  border-radius: 8px;
  border: 1px solid #555;
  background-color: #222;
  color: white;
  font-size: 1em;
  box-sizing: border-box;
  }
  .login-box button { 
  width: 100%;
  padding: 15px; 
  border: none; 
  border-radius: 8px; 
  color: white; 
  font-size: 1.1em; 
  cursor: pointer; 
  transition: background-color 0.2s; 
  }
  #sign-in-button { background-color: var(--gemini-purple); margin-bottom: 15px;}
  #sign-in-button:hover { background-color: #7a3a9b; }
  .message {
  margin-top: 15px;
  font-weight: bold;
  display: none;
  padding: 10px;
  border-radius: 5px;
  }
  .message.error { color: #fff; background-color: rgba(220, 53, 69, 0.5); }
  .message.success { color: #fff; background-color: rgba(40, 167, 69, 0.5); }
  #forgot-password-link {
  color: #ccc;
  text-decoration: none;
  font-size: 0.9em;
  margin-top: 10px;
  display: inline-block;
  }
  #forgot-password-link:hover { text-decoration: underline; }

  #ebook-content { display: none; width: 100%; height: 100%; }
  
  .desktop-auth-container { display: none; }
  
  .ebook-container { display: block; }
  
  #mobile-header {
    background: rgba(10, 25, 47, 0.85);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border-bottom: 1px solid var(--glass-border);
    height: var(--header-height);
    position: sticky;
    top: 0;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 1rem;
    width: 100%;
  }

  .menu-toggle-button {
    background: none;
    border: none;
    color: white;
    font-size: 2rem;
    cursor: pointer;
    padding: 0.5rem;
  }

  #mobile-auth-container {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  #mobile-user-email {
    font-size: 0.8rem;
    max-width: 150px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  #mobile-sign-out-button {
    background: var(--danger-color);
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 0.8rem;
  }

  #sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    z-index: 1005;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .sidebar-open #sidebar-overlay {
    opacity: 1;
    visibility: visible;
  }
  
  #sidebar { 
    width: var(--sidebar-width);
    background: rgba(10, 25, 47, 0.95); 
    backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); 
    padding: 25px; 
    overflow-y: auto; 
    position: fixed; 
    top: 0;
    left: 0;
    height: 100vh;
    z-index: 1010;
    box-shadow: 5px 0 15px rgba(0,0,0,0.3); 
    display: flex; 
    flex-direction: column;
    transform: translateX(-100%);
    transition: transform 0.3s ease-in-out;
  }

  .sidebar-open #sidebar {
    transform: translateX(0);
  }

  .sidebar-header { text-align: center; margin-bottom: 20px; }
  .logo { width: 150px; height: 150px; object-fit: contain; margin: 0 auto 10px;  background: transparent; padding: 25px; }
  #sidebar h2 { font-size: 1.8em; color: white; text-align: center; margin: 0; }
  #sidebar nav { flex-grow: 1; }
  #sidebar nav ul { list-style: none; padding: 0; }
  #sidebar nav > ul > li { margin-bottom: 10px; }
  #sidebar nav a { display: flex; align-items: center; gap: 12px; padding: 12px 18px; text-decoration: none; color: var(--text-light); font-weight: bold; border-radius: 8px; transition: all 0.3s ease; font-size: 1.1em; border: 1px solid transparent; }
  #sidebar nav a:hover, #sidebar nav a.active { color: white; transform: translateX(5px); }
  #sidebar .main-topic > a:hover, #sidebar .main-topic > a.active { background-color: var(--theme-color); border-color: var(--theme-border-color); color: var(--theme-text-color, white); }
  
  .main-topic.us-theme { --theme-color: var(--us-blue); --theme-border-color: var(--us-red); }
  .main-topic.br-theme { --theme-color: var(--br-green); --theme-border-color: var(--br-yellow); }
  .main-topic.crypto-theme { --theme-color: var(--crypto-black); --theme-border-color: var(--crypto-yellow); --theme-text-color: var(--crypto-yellow); }
  .main-topic.quiz-theme { --theme-color: var(--gemini-purple); --theme-border-color: #fff; }
  .main-topic.profile-theme { --theme-color: #17a2b8; --theme-border-color: #fff; }
  
  #main-content { 
    padding: 20px; 
    box-sizing: border-box; 
  }
  
  /* --- ESTILOS DO NOVO ACCORDION --- */
  .content-section-details {
    background: var(--glass-bg);
    backdrop-filter: blur(12px);
    border-radius: 15px;
    border: 1px solid var(--glass-border);
    margin-bottom: 20px;
    transition: all 0.3s ease;
  }
  .content-section-details:hover {
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 40px 0 rgba(0, 0, 0, 0.5);
  }
  .content-section-summary {
    padding: 20px;
    cursor: pointer;
    outline: none;
    list-style: none; /* Remove o marcador padrão */
  }
  .content-section-summary::-webkit-details-marker {
    display: none; /* Chrome */
  }
  .content-section-summary h2 {
    font-size: 1.5em; 
    margin: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-family: 'Poppins', sans-serif;
  }
   .content-section-summary h2::after {
    content: '▶';
    font-size: 0.8em;
    transition: transform 0.3s ease;
    transform: rotate(0deg);
  }
  .content-section-details[open] > .content-section-summary h2::after {
    transform: rotate(90deg);
  }
  .content-section-body {
    padding: 0 20px 20px 20px;
    animation: fadeInUp 0.5s ease-out forwards;
  }
  
  .sub-topic-details {
    border-top: 1px solid var(--glass-border);
    margin-top: 15px;
  }
  .sub-topic-summary {
    padding: 15px 0;
    cursor: pointer;
    outline: none;
    list-style: none;
  }
  .sub-topic-summary::-webkit-details-marker { display: none; }

  .sub-topic-summary h3 {
    font-size: 1.2em;
    margin: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .sub-topic-summary h3::after {
    content: '▶';
    font-size: 0.8em;
    transition: transform 0.3s ease;
    transform: rotate(0deg);
  }
  .sub-topic-details[open] > .sub-topic-summary h3::after {
    transform: rotate(90deg);
  }
  .sub-topic-body {
    padding-bottom: 15px;
    padding-left: 10px;
  }
  /* --- FIM DOS ESTILOS ACCORDION --- */
  
  .content-section h4 { font-size: 1.1em; margin-top: 20px; color: white; }
  .content-section p, .content-section li { color: #ddd; line-height: 1.7; }
  .content-section ul { list-style-position: inside; padding-left: 0; }
  .market-us h3 { color: #a9c7ff; border-color: var(--us-red); }
  .market-br h3 { color: #a6ffcb; border-color: var(--br-yellow); }
  .market-crypto h3 { color: var(--crypto-yellow); border-color: var(--crypto-yellow); }

  .title-flag { height: 1.2em; width: auto; border-radius: 4px; }
  strong { color: white; }
  code { font-family: 'Roboto Mono', monospace; background-color: rgba(255,255,255,0.1); padding: 3px 6px; border-radius: 4px; font-size: 0.9em; border: 1px solid rgba(255,255,255,0.2); }
  
  .video-embed-container { margin: 35px auto 0; text-align: center; position: relative; cursor: pointer; border-radius: 10px; overflow: hidden; border: 2px solid var(--glass-border); transition: transform 0.3s ease, box-shadow 0.3s ease; max-width: 640px; }
  .video-embed-container:hover { transform: scale(1.03); box-shadow: 0 8px 25px rgba(0,0,0,0.5); }
  .video-thumbnail { display: block; width: 100%; height: auto; }
  .video-embed-container .play-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80px; height: 80px; background-color: rgba(0, 0, 0, 0.6); border-radius: 50%; display: flex; align-items: center; justify-content: center; pointer-events: none; transition: background-color 0.3s ease; }
  .video-embed-container:hover .play-icon { background-color: rgba(220, 53, 69, 0.8); }
  .video-embed-container .play-icon::after { content: '▶'; font-size: 32px; color: white; margin-left: 5px; }
  .video-player-wrapper { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; background: #000; margin-top: 20px; }
  .video-player-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
  .audio-player-container { margin-top: 35px; margin-bottom: 20px; padding: 20px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 10px; }
  .audio-player-container h4 { margin-top: 0; margin-bottom: 15px; text-align: center; }
  audio { width: 100%; filter: sepia(20%) saturate(70%) grayscale(1) contrast(99%) invert(12%); }
  
  .chapter-navigation { margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center; gap: 15px; flex-wrap: wrap;  }
  .nav-button { padding: 10px 20px; text-decoration: none; font-weight: bold; color: var(--text-light); background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 8px; transition: all 0.3s ease; text-align: center; }
  .nav-button:hover { background: rgba(255, 255, 255, 0.2); transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
  .nav-button.prev::before { content: '« '; }
  .nav-button.next::after { content: ' »'; }

  .quiz-container details { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 20px; }
  .quiz-container summary { font-size: 1.3em; font-weight: bold; padding: 20px; cursor: pointer; outline: none; display: flex; justify-content: space-between; align-items: center; }
  .quiz-container summary::after { content: '▼'; transition: transform 0.3s; }
  .quiz-container details[open] summary::after { transform: rotate(180deg); }
  .quiz-form { padding: 0 20px 20px 20px; }
  .quiz-question { margin-bottom: 25px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
  .quiz-question p { font-weight: bold; color: #fff; margin-bottom: 10px; }
  .quiz-options label { display: block; background: rgba(0,0,0,0.2); padding: 12px; border-radius: 8px; margin-bottom: 8px; border: 1px solid #555; cursor: pointer; transition: background-color 0.2s; color: #ccc;}
  .quiz-options label:hover { background-color: rgba(255,255,255,0.1); }
  .quiz-options input { margin-right: 10px; }
  .quiz-result { margin-top: 30px; text-align: center; font-size: 1.5em; font-weight: bold; padding: 15px; border-radius: 8px;}
  .quiz-form button[type="submit"] { display: block; width: 100%; padding: 15px; font-size: 1.2em; background: var(--gemini-purple); color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px; }
  .correct { background-color: rgba(40, 167, 69, 0.3) !important; border-color: var(--success-color) !important; color: #fff; }
  .incorrect { background-color: rgba(220, 53, 69, 0.3) !important; border-color: var(--danger-color) !important; color: #fff; }
  .correct::after { content: ' ✔ Correto'; color: var(--success-color); font-weight: bold; margin-left: 10px; }
  .incorrect::after { content: ' ✖ Incorreto'; color: var(--danger-color); font-weight: bold; margin-left: 10px; }
  
  /* Estilos do Chatbot FAB e Popup */
  @keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(142, 68, 173, 0.7); }
  70% { box-shadow: 0 0 0 15px rgba(142, 68, 173, 0); }
  100% { box-shadow: 0 0 0 0 rgba(142, 68, 173, 0); }
  }
  #chat-fab { 
  position: fixed; 
  bottom: 20px; 
  right: 20px; 
  background-color: var(--gemini-purple); 
  color: white; 
  width: 55px; 
  height: 55px; 
  border-radius: 50%; 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  font-size: 26px; 
  cursor: pointer; 
  box-shadow: 0 4px 12px rgba(0,0,0,0.3); 
  transition: transform 0.2s; 
  z-index: 999; 
  animation: pulse 2s infinite;
  }
  #chat-fab:hover { transform: scale(1.1); animation-play-state: paused; }
  #chat-popup { 
    position: fixed; 
    bottom: 85px; 
    right: 20px;
    width: calc(100% - 40px);
    max-width: 400px; 
    height: 70vh; 
    max-height: 600px;
    background: rgba(10, 25, 47, 0.95); 
    backdrop-filter: blur(10px); 
    border-radius: 15px; 
    box-shadow: 0 5px 25px rgba(0,0,0,0.4); 
    display: none; 
    flex-direction: column; 
    overflow: hidden; 
    z-index: 1000; 
    opacity: 0; 
    transform: scale(0.95) translateY(10px); 
    transform-origin: bottom right; 
    pointer-events: none; 
    transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out; 
  }
  #chat-popup.show-chat { display: flex; opacity: 1; transform: scale(1) translateY(0); pointer-events: auto; }
  .chat-header {
  background: linear-gradient(to right, #2c3e50, #4a6a8a);
  padding: 1rem;
  flex-shrink: 0;
  }
  .chat-bubble {
  animation: fadeIn 0.4s ease-out;
  }
  .suggestion-btn-container {
  animation: fadeIn 0.4s ease-out;
  }
  @keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
  }
  .typing-indicator {
  display: flex;
  align-items: center;
  padding: 10px 15px;
  }
  .typing-indicator span {
  height: 8px;
  width: 8px;
  background-color: #9e9e9e;
  border-radius: 50%;
  display: inline-block;
  margin: 0 2px;
  animation: bounce 1.4s infinite ease-in-out both;
  }
  .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
  .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
  @keyframes bounce {
  0%, 80%, 100% { transform: scale(0); }
  40% { transform: scale(1.0); }
  }

  /* --- ESTILOS DOS NOVOS ELEMENTOS --- */
  #profile-quiz-result {
  display: none;
  margin-top: 30px;
  padding: 20px;
  border-radius: 10px;
  background-color: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.2);
  text-align: center;
  }
  .profile-conservative { color: var(--success-color); }
  .profile-moderate { color: var(--warning-color); }
  .profile-aggressive { color: var(--danger-color); }

  .interactive-checklist {
  margin: 25px 0;
  padding: 20px;
  background: var(--glass-bg);
  border-radius: 10px;
  }
  .progress-bar-container {
  width: 100%;
  background-color: rgba(0,0,0,0.3);
  border-radius: 5px;
  margin-bottom: 15px;
  }
  .progress-bar-fill {
  height: 10px;
  width: 0%;
  background-color: var(--gemini-purple);
  border-radius: 5px;
  transition: width 0.4s ease-in-out;
  }
  .checklist-item {
  display: block;
  background-color: rgba(0,0,0,0.2);
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 8px;
  border-left: 4px solid #555;
  cursor: pointer;
  transition: all 0.2s;
  }
  .checklist-item:hover {
  background-color: rgba(255,255,255,0.1);
  }
  .checklist-item.completed {
  border-left-color: var(--success-color);
  background-color: rgba(40, 167, 69, 0.15);
  }
  .checklist-item.completed span {
  text-decoration: line-through;
  color: #888;
  }
  .checklist-item input[type="checkbox"] {
  margin-right: 15px;
  width: 18px;
  height: 18px;
  accent-color: var(--gemini-purple);
  }

  .metrics-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
  }

  .metric-card {
  background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
  border: 1px solid var(--glass-border);
  border-radius: 10px;
  padding: 15px;
  text-align: center;
  animation: fadeInUp 0.5s ease-out forwards;
  min-height: 130px; 
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  }
  
  /* CORREÇÃO PARA O COPYRIGHT DO WIDGET */
  .tradingview-widget-copyright {
    font-size: 0.7rem !important;
    text-align: center;
  }

  /* --- MEDIA QUERY PARA DESKTOP (MOBILE-FIRST) --- */
  @media (min-width: 801px) {
    body.app-view {
      display: flex;
    }
    #mobile-header {
      display: none;
    }
    #sidebar {
      position: fixed;
      transform: translateX(0);
      width: var(--sidebar-width);
      min-width: var(--sidebar-width);
      border-right: 1px solid var(--glass-border);
    }
    #sidebar-overlay {
      display: none;
    }
    #main-content {
      flex-grow: 1;
      margin-left: var(--sidebar-width);
      padding: 40px;
    }
    .content-section-summary h2 {
      font-size: 2.5em;
    }
    .sub-topic-summary h3 {
      font-size: 1.6em;
    }
    .desktop-auth-container {
      display: flex;
      position: fixed;
      top: 15px;
      right: 20px;
      background-color: rgba(0,0,0,0.5);
      padding: 8px 15px;
      border-radius: 20px;
      align-items: center;
      gap: 15px;
      z-index: 1001;
      backdrop-filter: blur(5px);
    }
    #sign-out-button {
      background: var(--danger-color);
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    #chat-fab {
      bottom: 30px; 
      right: 30px;
      width: 60px; 
      height: 60px;
      font-size: 30px;
    }
    #chat-popup {
      bottom: 100px;
      right: 30px;
      width: 400px;
      height: 600px;
    }
  }

  </style>
 </head>
 <body class="login-view no-scroll">
  <canvas id="animated-background"></canvas>
  
  <div id="login-screen">
      <div class="login-box">
          <img src="https://i.imgur.com/gDM2x1i.png" alt="Logo Xtraders" style="width: 120px; height: auto; margin: 0 auto 20px;">
          <h2>Acesso ao E-book</h2>
          <p>Faça login para continuar.</p>
          <input type="email" id="email-input" placeholder="Digite o seu e-mail">
          <input type="password" id="password-input" placeholder="Digite a sua senha">
          <button id="sign-in-button">Entrar</button>
          <a href="#" id="forgot-password-link">Esqueceu a senha?</a>
          <p id="message" class="message"></p>
      </div>
  </div>

  <div id="ebook-content">
      <header id="mobile-header">
          <button id="menu-toggle" class="menu-toggle-button" aria-label="Abrir menu">☰</button>
          <div id="mobile-auth-container">
              <span id="mobile-user-email"></span>
              <button id="mobile-sign-out-button">Sair</button>
          </div>
      </header>

      <div class="desktop-auth-container">
          <span id="user-email"></span>
          <button id="sign-out-button">Sair</button>
      </div>
      
      <div id="sidebar-overlay"></div>
      
      <div class="ebook-container">
          <aside id="sidebar">
              <div class="sidebar-header">
                  <img src="https://i.imgur.com/gDM2x1i.png" alt="Logo Xtraders" class="logo">
                  <h2 style="display: none;">Xtraders</h2>
              </div>
              <nav>
                  <ul>
                      <li class="main-topic us-theme"><a href="#mercado-americano"><img src="https://flagcdn.com/w40/us.png" class="title-flag" alt="Bandeira dos EUA"> Mercado Americano</a></li>
                      <li class="main-topic br-theme"><a href="#mercado-brasileiro"><img src="https://flagcdn.com/w40/br.png" class="title-flag" alt="Bandeira do Brasil"> Mercado Brasileiro</a></li>
                      <li class="main-topic crypto-theme"><a href="#criptoativos">🪙 Criptoativos</a></li>
                      <li class="main-topic profile-theme"><a href="#perfil-investidor">🤔 Perfil de Investidor</a></li>
                      <li class="main-topic quiz-theme"><a href="#quiz">✅ Quiz de Aprendizagem</a></li>
                  </ul>
              </nav>
          </aside>
          
          <main id="main-content">
              <details id="mercado-americano" class="content-section-details market-us">
                  <summary class="content-section-summary">
                      <h2><img src="https://flagcdn.com/w80/us.png" class="title-flag" alt="Bandeira dos EUA"> Mercado Americano</h2>
                  </summary>
                  <div class="content-section-body">
                      </div>
              </details>

              <details id="mercado-brasileiro" class="content-section-details market-br">
                  <summary class="content-section-summary">
                      <h2><img src="https://flagcdn.com/w80/br.png" class="title-flag" alt="Bandeira do Brasil"> Mercado Brasileiro</h2>
                  </summary>
                  <div class="content-section-body">
                      </div>
              </details>
              
              <details id="criptoativos" class="content-section-details market-crypto">
                  <summary class="content-section-summary">
                      <h2>🪙 Criptoativos</h2>
                  </summary>
                  <div class="content-section-body">
                       </div>
              </details>

              <details id="perfil-investidor" class="content-section-details profile-theme">
                  <summary class="content-section-summary">
                      <h2>🤔 Perfil de Investidor</h2>
                  </summary>
                  <div class="content-section-body">
                      <p>Entender a sua tolerância ao risco é o primeiro passo para uma jornada de investimentos bem-sucedida. Este questionário, similar ao <strong>Suitability</strong> exigido pelas corretoras como a Genial Investimentos, ajudá-lo-á a ter uma ideia clara do seu perfil. Responda com sinceridade!</p>
                      <form id="profile-quiz-form" class="quiz-form">
                          <div class="questions-wrapper">
                            <div class="quiz-question">
                                <p>1. Qual é o seu principal objetivo ao investir?</p>
                                <div class="quiz-options">
                                    <label><input type="radio" name="q1" value="1" required> Preservar meu patrimônio, evitando perdas a todo custo.</label>
                                    <label><input type="radio" name="q1" value="2" required> Equilibrar segurança com uma boa rentabilidade, aceitando flutuações moderadas.</label>
                                    <label><input type="radio" name="q1" value="3" required> Maximizar os ganhos, mesmo que isso signifique correr riscos elevados e aceitar perdas no curto prazo.</label>
                                </div>
                            </div>
                            <div class="quiz-question">
                                <p>2. Por quanto tempo você pretende manter seus investimentos aplicados?</p>
                                <div class="quiz-options">
                                    <label><input type="radio" name="q2" value="1" required> Curto prazo (até 2 anos).</label>
                                    <label><input type="radio" name="q2" value="2" required> Médio prazo (de 2 a 5 anos).</label>
                                    <label><input type="radio" name="q2" value="3" required> Longo prazo (mais de 5 anos).</label>
                                </div>
                            </div>
                            <div class="quiz-question">
                                <p>3. Seus investimentos perdem 20% do valor em um mês. Qual sua atitude?</p>
                                <div class="quiz-options">
                                    <label><input type="radio" name="q3" value="1" required> Venderia tudo para não perder mais.</label>
                                    <label><input type="radio" name="q3" value="2" required> Manteria a posição, pois entendo que o mercado oscila.</label>
                                    <label><input type="radio" name="q3" value="3" required> Compraria mais, aproveitando a oportunidade de "preço baixo".</label>
                                </div>
                            </div>
                            <div class="quiz-question">
                                <p>4. Qual a sua familiaridade com produtos de renda variável (Ações, Fundos Imobiliários, Minicontratos, Cripto)?</p>
                                <div class="quiz-options">
                                    <label><input type="radio" name="q4" value="1" required> Nenhuma ou muito baixa. Prefiro produtos mais simples como Poupança ou Tesouro Selic.</label>
                                    <label><input type="radio" name="q4" value="2" required> Média. Conheço alguns produtos, já estudei o básico e talvez tenha algum investimento.</label>
                                    <label><input type="radio" name="q4" value="3" required> Alta. Conheço bem a maioria dos produtos e opero ou pretendo operar com frequência.</label>
                                </div>
                            </div>
                            <div class="quiz-question">
                                <p>5. Qual das seguintes frases descreve melhor a sua situação financeira atual?</p>
                                <div class="quiz-options">
                                    <label><input type="radio" name="q5" value="1" required> Meus rendimentos são apenas para cobrir minhas despesas essenciais.</label>
                                    <label><input type="radio" name="q5" value="2" required> Consigo cobrir minhas despesas, pagar por lazer e ainda sobra um valor para investir.</label>
                                    <label><input type="radio" name="q5" value="3" required> Tenho um patrimônio consolidado e uma alta capacidade de poupança e investimento.</label>
                                </div>
                            </div>
                            <div class="quiz-question">
                                <p>6. Que percentual do seu patrimônio você estaria confortável em alocar em investimentos de maior risco?</p>
                                <div class="quiz-options">
                                    <label><input type="radio" name="q6" value="1" required> Menos de 10%.</label>
                                    <label><input type="radio" name="q6" value="2" required> Entre 10% e 30%.</label>
                                    <label><input type="radio" name="q6" value="3" required> Acima de 30%.</label>
                                </div>
                            </div>
                            <div class="quiz-question">
                                <p>7. Você possui formação acadêmica ou certificações na área financeira (economia, finanças, CEA, etc.)?</p>
                                <div class="quiz-options">
                                    <label><input type="radio" name="q7" value="1" required> Não, minha área de atuação é completamente diferente.</label>
                                    <label><input type="radio" name="q7" value="2" required> Não, mas estudo o mercado financeiro por conta própria com frequência.</label>
                                    <label><input type="radio" name="q7" value="3" required> Sim, possuo formação ou certificação na área.</label>
                                </div>
                            </div>
                            <div class="quiz-question">
                                <p>8. Com que frequência você pode precisar resgatar uma parte significativa dos seus investimentos?</p>
                                <div class="quiz-options">
                                    <label><input type="radio" name="q8" value="1" required> Alta. Posso precisar do dinheiro a qualquer momento (menos de 6 meses).</label>
                                    <label><input type="radio" name="q8" value="2" required> Média. Talvez precise em 1 ou 2 anos.</label>
                                    <label><input type="radio" name="q8" value="3" required> Baixa. Este é um dinheiro que não precisarei no curto ou médio prazo.</label>
                                </div>
                            </div>
                            <div class="quiz-question">
                                <p>9. Há quanto tempo você investe no mercado financeiro?</p>
                                <div class="quiz-options">
                                    <label><input type="radio" name="q9" value="1" required> Nunca investi ou comecei há menos de 1 ano.</label>
                                    <label><input type="radio" name="q9" value="2" required> Invisto entre 1 e 5 anos.</label>
                                    <label><input type="radio" name="q9" value="3" required> Invisto há mais de 5 anos e tenho experiência sólida.</label>
                                </div>
                            </div>
                            <div class="quiz-question">
                                <p>10. Como você se sente em relação à possibilidade de perder parte do seu capital em busca de maiores retornos?</p>
                                <div class="quiz-options">
                                    <label><input type="radio" name="q10" value="1" required> Extremamente desconfortável. Prefiro não correr riscos.</label>
                                    <label><input type="radio" name="q10" value="2" required> Aceito perdas pequenas e controladas como parte do processo.</label>
                                    <label><input type="radio" name="q10" value="3" required> Vejo as perdas como oportunidades e entendo que são necessárias para grandes ganhos.</label>
                                </div>
                            </div>
                          </div>
                          <button type="submit">Ver o Meu Perfil</button>
                          <div id="profile-quiz-result" class="quiz-result" style="font-size: 1.2em; display: none;"></div>
                      </form>
                  </div>
              </details>

              <details id="quiz" class="content-section-details quiz-theme">
                  <summary class="content-section-summary">
                      <h2>✅ Quiz de Aprendizagem</h2>
                  </summary>
                  <div class="content-section-body quiz-container">
                      <details><summary class="us-theme">Prova: Mercado Americano 🇺🇸</summary><form class="quiz-form" id="quiz-americano"><div class="questions-wrapper"></div><button type="submit">Verificar Respostas</button><div class="quiz-result"></div></form></details>
                      <details><summary class="br-theme">Prova: Mercado Brasileiro (B3) 🇧🇷</summary><form class="quiz-form" id="quiz-brasileiro"><div class="questions-wrapper"></div><button type="submit">Verificar Respostas</button><div class="quiz-result"></div></form></details>
                      <details><summary class="crypto-theme">Prova: Criptoativos 🪙</summary><form class="quiz-form" id="quiz-cripto"><div class="questions-wrapper"></div><button type="submit">Verificar Respostas</button><div class="quiz-result"></div></form></details>
                  </div>
              </details>
          </main>
      </div>
      
      <div id="chat-fab">💬</div>

      <div id="chat-popup">
          <div id="chatbot-container" class="w-full h-full bg-gray-800 flex flex-col">
              <div id="theme-selection" class="flex-1 flex flex-col justify-center items-center p-4 text-center">
                  <h1 class="text-2xl font-bold mb-2 text-white">Assistente Virtual</h1>
                  <p class="text-gray-400 mb-6">Sobre qual assunto você gostaria de falar?</p>
                  <div class="grid grid-cols-1 gap-3 w-full">
                      <button data-theme="Criptoativos" class="theme-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg text-base transition-transform transform hover:scale-105">
                          🪙 Criptoativos
                      </button>
                      <button data-theme="Mercado Brasileiro" class="theme-btn bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg text-base transition-transform transform hover:scale-105">
                          🇧🇷 Mercado Brasileiro (B3)
                      </button>
                      <button data-theme="Mercado Americano" class="theme-btn bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg text-base transition-transform transform hover:scale-105">
                          🇺🇸 Mercado Americano
                      </button>
                  </div>
                   <button id="close-chat" class="text-gray-400 hover:text-white mt-6 text-sm">Fechar</button>
              </div>

              <div id="chat-window" class="hidden h-full w-full flex-col">
                  <div class="flex items-center justify-between p-3 border-b border-gray-700 chat-header">
                      <button id="chatbot-back-btn" class="text-gray-300 hover:text-white text-sm">← Trocar Tema</button>
                      <h2 id="chatbot-title" class="text-lg font-semibold text-center text-white"></h2>
                      <div class="w-20"></div> </div>
                  <div id="chatbot-messages" class="flex-1 p-4 overflow-y-auto space-y-4 flex flex-col">
                      </div>
                  <div class="p-2 border-t border-gray-700">
                      <div class="flex items-center bg-gray-700 rounded-lg">
                          <input type="text" id="chatbot-input" class="w-full bg-transparent p-3 text-white focus:outline-none text-sm" placeholder="Digite sua pergunta...">
                          <button id="chatbot-send-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg m-1 text-sm">
                              Enviar
                          </button>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>

 <script type="module">
  import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

  const API_KEY = "AIzaSyBrBfHkU9wpED4nvWGN0R-mgYtzcusDnBU";
  const genAI = new GoogleGenerativeAI(API_KEY);
  const model = genAI.getGenerativeModel({ model: "gemini-1.5-pro-latest" });

  window.genAI = genAI;
  window.geminiModel = model;

  console.log("Gemini API carregada com sucesso.");
 </script>

 </body>
 </html>
