<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>E-book Interativo: Acesso Seguro</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Roboto+Mono:wght@400;700&family=Poppins:wght@600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <script type="module">
    // Importa as fun√ß√µes necess√°rias dos SDKs do Firebase
    import {
      initializeApp
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      onAuthStateChanged,
      signOut,
      sendPasswordResetEmail
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    // --- Configura√ß√£o do Firebase com as suas chaves ---
    const firebaseConfig = {
      apiKey: "AIzaSyB3xbnaVIViIX0-WvZTA7KUkYxKpH-fqPs",
      authDomain: "ebookxtrader.firebaseapp.com",
      projectId: "ebookxtrader",
      storageBucket: "ebookxtrader.appspot.com",
      messagingSenderId: "682023817418",
      appId: "1:682023817418:web:1eeba2841ae553e2716433"
    };

    // Inicializa o Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // --- L√ìGICA DE AUTENTICA√á√ÉO ---
    const loginScreen = document.getElementById('login-screen');
    const ebookContent = document.getElementById('ebook-content');
    const authContainer = document.getElementById('auth-container');
    const userEmailDisplay = document.getElementById('user-email');
    const signOutButton = document.getElementById('sign-out-button');
    const emailInput = document.getElementById('email-input');
    const passwordInput = document.getElementById('password-input');
    const signInButton = document.getElementById('sign-in-button');
    const forgotPasswordLink = document.getElementById('forgot-password-link');
    const messageElement = document.getElementById('message');

    signInButton.addEventListener('click', () => {
      const email = emailInput.value;
      const password = passwordInput.value;
      messageElement.style.display = 'none';

      signInWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          console.log('Login efetuado com sucesso!', userCredential.user);
        })
        .catch((error) => {
          messageElement.textContent = `Erro ao entrar: ${error.message}`;
          messageElement.className = 'message error';
          messageElement.style.display = 'block';
        });
    });

    forgotPasswordLink.addEventListener('click', (e) => {
      e.preventDefault();
      const email = emailInput.value;
      messageElement.style.display = 'none';

      if (!email) {
        messageElement.textContent = 'Por favor, insira o seu e-mail para redefinir a senha.';
        messageElement.className = 'message error';
        messageElement.style.display = 'block';
        return;
      }

      sendPasswordResetEmail(auth, email)
        .then(() => {
          messageElement.textContent = 'E-mail de redefini√ß√£o enviado! Verifique a sua caixa de entrada.';
          messageElement.className = 'message success';
          messageElement.style.display = 'block';
        })
        .catch((error) => {
          messageElement.textContent = `Erro ao enviar e-mail: ${error.message}`;
          messageElement.className = 'message error';
          messageElement.style.display = 'block';
        });
    });

    signOutButton.addEventListener('click', () => {
      signOut(auth).then(() => {
        console.log('Logout efetuado com sucesso.');
      }).catch((error) => {
        console.error('Erro ao fazer logout:', error);
      });
    });

    onAuthStateChanged(auth, (user) => {
      const body = document.body;
      if (user) {
        loginScreen.style.display = 'none';
        ebookContent.style.display = 'block';
        authContainer.style.display = 'flex';
        userEmailDisplay.textContent = user.email;
        body.style.overflow = 'auto';

        if (!window.ebookScriptsInitialized) {
          initializeEbookScripts();
          window.ebookScriptsInitialized = true;
        }
      } else {
        loginScreen.style.display = 'flex';
        ebookContent.style.display = 'none';
        authContainer.style.display = 'none';
        body.style.overflow = 'hidden';
        window.ebookScriptsInitialized = false;
      }
    });

    // --- SCRIPTS DO E-BOOK E CHATBOT (EXECUTADOS AP√ìS LOGIN) ---
    function initializeEbookScripts() {
      console.log("Scripts do e-book e chatbot inicializados!");

      // --- L√ìGICA DO ACCORDION (GAVETAS) ---
      const drawers = document.querySelectorAll('#main-content details');
      drawers.forEach((drawer) => {
        drawer.addEventListener('toggle', (event) => {
          // Se esta gaveta foi aberta, feche todas as outras.
          if (drawer.open) {
            drawers.forEach((otherDrawer) => {
              if (otherDrawer !== drawer) {
                otherDrawer.open = false;
              }
            });
          }
        });
      });


      document.querySelectorAll('.video-embed-container').forEach(container => {
        container.addEventListener('click', () => {
          const videoId = container.getAttribute('data-video-id');
          const iframeHtml = `<div class="video-player-wrapper"><iframe src="http://googleusercontent.com/youtube.com/2{videoId}?autoplay=1&rel=0" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`;
          container.innerHTML = iframeHtml;
        }, {
          once: true
        });
      });

      const quiz = {
        americano: {
          questions: [{
            q: "Qual √≠ndice representa as 500 maiores empresas dos EUA?",
            a: ["Nasdaq Composite", "Nasdaq-100", "S&P 500", "Dow Jones", "Russell 2000"],
            correct: 2
          }, {
            q: "O que √© o Nasdaq-100?",
            a: ["√çndice com a√ß√µes da NYSE", "√çndice focado apenas em bancos", "√çndice das 500 maiores empresas", "√çndice das 100 maiores empresas n√£o financeiras da Nasdaq", "√çndice de commodities"],
            correct: 3
          }, {
            q: "Qual √© a principal vantagem de operar no mercado americano?",
            a: ["Isen√ß√£o de impostos", "Ganhos em d√≥lar e maior liquidez", "Custos operacionais mais altos", "Menor volatilidade", "Aus√™ncia de risco cambial"],
            correct: 1
          }, {
            q: "O que √© o USATEC/US100?",
            a: ["CFD que representa o √≠ndice Nasdaq-100", "Um ETF brasileiro", "√çndice de petr√≥leo americano", "A√ß√µes da Tesla", "√çndice do setor banc√°rio dos EUA"],
            correct: 0
          }, {
            q: "O que √© o spread?",
            a: ["Comiss√£o da corretora", "Taxa fixa de opera√ß√£o", "Diferen√ßa entre pre√ßo de compra e venda", "Lucro l√≠quido da opera√ß√£o", "Valor da margem"],
            correct: 2
          }, {
            q: "Quais ativos s√£o mais negociados nos EUA?",
            a: ["A√ß√µes da B3", "ETFs europeus", "Commodities brasileiras", "Nasdaq, Bitcoin, Ouro, EUR/USD", "Fundos de pens√£o"],
            correct: 3
          }, {
            q: "Qual a plataforma citada para operar nos EUA com suporte em portugu√™s?",
            a: ["MetaTrader 4", "BlackArrow via ZeroMarkets", "Profit Pro", "XP Trader", "Binance"],
            correct: 1
          }, {
            q: "O que √© FOMC?",
            a: ["√çndice de a√ß√µes", "Comit√™ Federal de Mercado Aberto do Fed", "Exchange de criptomoedas", "Ag√™ncia de rating", "Plataforma de negocia√ß√£o"],
            correct: 1
          }, {
            q: "Quais s√£o os hor√°rios de maior liquidez no mercado americano (hor√°rio de Bras√≠lia)?",
            a: ["8h √†s 9h", "12h √†s 14h", "10h30 √†s 12h e 15h30 √†s 17h", "18h √†s 20h", "22h √†s 0h"],
            correct: 2
          }, {
            q: "O que indica o CPI americano?",
            a: ["Crescimento do PIB", "Desemprego", "Infla√ß√£o ao consumidor", "Balan√ßa comercial", "Pol√≠tica monet√°ria"],
            correct: 2
          }]
        },
        brasileiro: {
          questions: [{
            q: "O que √© a B3?",
            a: ["Ag√™ncia de regula√ß√£o de bancos", "Bolsa oficial de valores do Brasil", "Empresa de investimentos em petr√≥leo", "Banco Central", "Fundo imobili√°rio"],
            correct: 1
          }, {
            q: "O que o Ibovespa representa?",
            a: ["Taxa Selic", "Principais a√ß√µes da B3", "Moeda do Brasil", "Pre√ßo do d√≥lar futuro", "PIB nacional"],
            correct: 1
          }, {
            q: "O que √© o contrato WIN?",
            a: ["A√ß√£o da Petrobras", "Minicontrato do √≠ndice Bovespa", "ETF de commodities", "Fundo de dividendos", "T√≠tulo do Tesouro"],
            correct: 1
          }, {
            q: "O que √© o contrato WDO?",
            a: ["Minicontrato da Vale", "A√ß√£o do d√≥lar", "Minicontrato do d√≥lar", "Fundo cambial", "ETF internacional"],
            correct: 2
          }, {
            q: "Qual √© a fun√ß√£o das m√©dias m√≥veis?",
            a: ["Calcular o IR", "Suavizar o pre√ßo e indicar tend√™ncia", "Medir liquidez", "Avaliar spread", "Mostrar a margem exigida"],
            correct: 1
          }, {
            q: "O que representa o √≠ndice IDIV?",
            a: ["√çndice de empresas pequenas", "Lucros do setor de energia", "Empresas com bom hist√≥rico de dividendos", "√çndice de a√ß√µes do exterior", "Carteira te√≥rica de fundos"],
            correct: 2
          }, {
            q: "O que √© um stop-loss t√©cnico?",
            a: ["Ordem para encerrar uma opera√ß√£o com base em an√°lise gr√°fica", "Ordem para realizar lucro", "Alvo de entrada", "M√©dia m√≥vel de revers√£o", "Indicador de volume"],
            correct: 0
          }, {
            q: "Qual plataforma √© mais utilizada para operar na B3?",
            a: ["Binance", "Profit Pro", "BlackArrow", "MetaTrader 4", "Trust Wallet"],
            correct: 1
          }, {
            q: "O que significa operar vendido?",
            a: ["Comprar com alavancagem", "Investir em renda fixa", "Apostar na queda do ativo", "Vender a√ß√µes f√≠sicas", "Vender derivativos em carteira"],
            correct: 2
          }, {
            q: "Qual o valor m√©dio de stop no mini √≠ndice?",
            a: ["500 pontos", "150 a 200 pontos", "10 pontos", "300 a 400 pontos", "20 pontos"],
            correct: 1
          }]
        },
        cripto: {
          questions: [{
            q: "O que s√£o criptomoedas?",
            a: ["Moedas f√≠sicas com lastro em ouro", "Ativos digitais descentralizados baseados em blockchain", "Cart√µes pr√©-pagos internacionais", "A√ß√µes de empresas de tecnologia", "Moedas do governo digital"],
            correct: 1
          }, {
            q: "Qual a principal fun√ß√£o do Bitcoin?",
            a: ["Moeda nacional de El Salvador", "Reserva de valor descentralizada", "Gateway de pagamentos", "Token da Ethereum", "Moeda para jogos"],
            correct: 1
          }, {
            q: "Quem √© Satoshi Nakamoto?",
            a: ["CEO da Binance", "Criador do Bitcoin (identidade desconhecida)", "Regra de consenso", "Dono da blockchain", "Fundador da Coinbase"],
            correct: 1
          }, {
            q: "O que √© blockchain?",
            a: ["Banco de dados p√∫blico e imut√°vel que registra transa√ß√µes", "Sistema banc√°rio europeu", "Moeda de jogos online", "Software de an√°lise gr√°fica", "Rede de IPFS"],
            correct: 0
          }, {
            q: "O que √© Proof of Work?",
            a: ["Modo de converter real em cripto", "Mecanismo de valida√ß√£o via poder computacional", "Prova de transa√ß√£o digital", "Sistema de auditoria banc√°ria", "Protocolo de recupera√ß√£o de senha"],
            correct: 1
          }, {
            q: "O que significa ‚ÄúNot your keys, not your coins‚Äù?",
            a: ["Seu saldo est√° sempre em blockchain", "Se voc√™ n√£o tem a chave privada, n√£o controla seus criptoativos", "Todas as chaves s√£o p√∫blicas", "Frase usada por exchanges", "Significa backup de carteira"],
            correct: 1
          }, {
            q: "O que √© uma hot wallet?",
            a: ["Carteira conectada √† internet", "Cold wallet com backup", "Plataforma de minera√ß√£o", "Exchange de criptomoedas", "Dispositivo f√≠sico"],
            correct: 0
          }, {
            q: "Qual a principal stablecoin do mercado?",
            a: ["Bitcoin", "Ethereum", "Tether (USDT)", "Litecoin", "Solana"],
            correct: 2
          }, {
            q: "Como a Receita Federal trata as criptomoedas no Brasil?",
            a: ["Como moeda estrangeira", "Como bens ou direitos que devem ser declarados", "Como renda vari√°vel", "Como isentas de tributos", "Como previd√™ncia privada"],
            correct: 1
          }, {
            q: "O que √© uma DAO?",
            a: ["Exchange descentralizada", "Organiza√ß√£o aut√¥noma gerida por contratos inteligentes", "Nome da blockchain da Ethereum", "Protocolo de NFT", "Carteira virtual multichave"],
            correct: 1
          }]
        }
      };

      document.querySelectorAll('.quiz-form').forEach(form => {
        const quizId = form.id.split('-')[1];
        const quizData = quiz[quizId];

        if (!quizData) {
          return;
        }

        const questionsWrapper = form.querySelector('.questions-wrapper');
        const resultDiv = form.querySelector('.quiz-result');

        if (questionsWrapper) {
          questionsWrapper.innerHTML = '';
          quizData.questions.forEach((item, index) => {
            const questionDiv = document.createElement('div');
            questionDiv.className = 'quiz-question';
            questionDiv.innerHTML = `<p>${index + 1}. ${item.q}</p>`;
            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'quiz-options';
            item.a.forEach((option, optionIndex) => {
              const label = document.createElement('label');
              label.innerHTML = `<input type="radio" name="question${index}" value="${optionIndex}"> ${option}`;
              optionsDiv.appendChild(label);
            });
            questionDiv.appendChild(optionsDiv);
            questionsWrapper.appendChild(questionDiv);
          });
        }

        form.addEventListener('submit', e => {
          e.preventDefault();
          let score = 0;
          const totalQuestions = quizData.questions.length;
          quizData.questions.forEach((item, index) => {
            const selected = form.querySelector(`input[name="question${index}"]:checked`);
            const labels = form.querySelectorAll(`input[name="question${index}"]`);
            labels.forEach(label => {
              label.parentElement.classList.remove('correct', 'incorrect');
            });
            if (selected) {
              const answer = parseInt(selected.value);
              const correctIndex = item.correct;
              if (answer === correctIndex) {
                score++;
                selected.parentElement.classList.add('correct');
              } else {
                selected.parentElement.classList.add('incorrect');
                labels[correctIndex].parentElement.classList.add('correct');
              }
            }
          });
          if (resultDiv) {
            resultDiv.innerHTML = `Voc√™ acertou ${score} de ${totalQuestions} quest√µes!`;
            resultDiv.style.color = score > totalQuestions / 2 ? 'var(--success-color)' : 'var(--danger-color)';
          }
        });
      });

      // --- L√≥gica do Chatbot ---
      const chatFab = document.getElementById('chat-fab');
      const chatPopup = document.getElementById('chat-popup');
      const closeChatBtn = document.getElementById('close-chat');

      chatFab.addEventListener('click', () => {
        chatPopup.classList.add('show-chat');
        chatFab.style.display = 'none';
      });
      closeChatBtn.addEventListener('click', () => {
        chatPopup.classList.remove('show-chat');
        chatFab.style.display = 'flex';
      });

      const chatbotContainer = document.getElementById('chatbot-container');
      const themeSelectionDiv = document.getElementById('theme-selection');
      const chatWindowDiv = document.getElementById('chat-window');
      const themeButtons = document.querySelectorAll('.theme-btn');
      const backBtn = document.getElementById('chatbot-back-btn');
      const chatTitle = document.getElementById('chatbot-title');
      const chatMessages = document.getElementById('chatbot-messages');
      const chatInput = document.getElementById('chatbot-input');
      const sendBtn = document.getElementById('chatbot-send-btn');

      let currentTheme = null;

      // --- L√≥gica da IA do Gemini ---
      const API_KEY = "AIzaSyBrBfHkU9wpED4nvWGN0R-mgYtzcusDnBU";
      let genAI, model;

      if (API_KEY) {
        try {
          genAI = window.genAI;
          model = window.geminiModel;
        } catch (error) {
          console.error("Erro ao inicializar a API do Gemini. Verifique sua chave.", error);
          genAI = null;
          model = null;
        }
      } else {
        console.warn("A chave da API do Gemini n√£o foi fornecida. O chatbot usar√° apenas a base de conhecimento local.");
      }

      const knowledgeBase = {
        "Criptoativos": {
          "O que s√£o criptomoedas?": "‚û° Ativos digitais descentralizados que utilizam a tecnologia blockchain para garantir seguran√ßa, transpar√™ncia e independ√™ncia de intermedi√°rios.",
          "O que √© Bitcoin?": "‚û° Primeira criptomoeda criada, em 2008, por Satoshi Nakamoto como resposta √† crise financeira.",
          "Quem √© Satoshi Nakamoto?": "‚û° Pseud√¥nimo do criador do Bitcoin; sua identidade verdadeira √© desconhecida.",
          "O que √© blockchain?": "‚û° Cadeia de blocos que armazena transa√ß√µes de forma imut√°vel e distribu√≠da.",
        },
        "Mercado Brasileiro": {
          "O que √© a B3?": "‚û° Bolsa de Valores oficial do Brasil.",
          "O que √© o Ibovespa?": "‚û° Principal √≠ndice da B3, com a√ß√µes mais negociadas.",
        },
        "Mercado Americano": {
          "O que √© a Nasdaq?": "‚û° Bolsa americana focada em empresas de tecnologia.",
          "O que √© o S&P 500?": "‚û° √çndice das 500 maiores empresas de capital aberto dos EUA.",
        }
      };

      async function getChatbotResponse(theme, question) {
        const themeKB = knowledgeBase[theme];

        if (themeKB && themeKB[question]) {
          return themeKB[question];
        }

        if (model) {
          try {
            const prompt = `Voc√™ √© um assistente virtual amig√°vel e especialista em finan√ßas. O usu√°rio est√° no t√≥pico '${theme}'. Responda √† pergunta de forma clara e concisa: "${question}"`;

            const result = await model.generateContent(prompt);
            const response = await result.response;
            return response.text();

          } catch (error) {
            console.error("Erro ao contatar a API do Gemini:", error);
            return "Desculpe, estou com um problema para me conectar. Tente novamente mais tarde.";
          }
        } else {
          return "N√£o encontrei uma resposta para essa pergunta. A funcionalidade de IA n√£o est√° ativa.";
        }
      }

      function addChatMessage(text, sender) {
        const bubble = document.createElement('div');
        bubble.className = `chat-bubble max-w-md md:max-w-lg p-3 rounded-xl ${sender === 'user' ? 'chat-bubble-user self-end bg-blue-600 text-white' : 'chat-bubble-bot self-start bg-gray-700 text-gray-300'}`;
        bubble.textContent = text;
        chatMessages.appendChild(bubble);
        scrollToChatBottom();
      }

      function scrollToChatBottom() {
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      async function handleChatSend(messageText) {
        const userMessage = messageText.trim();
        if (userMessage === '') return;

        addChatMessage(userMessage, 'user');
        chatInput.value = '';

        const botResponse = await getChatbotResponse(currentTheme, userMessage);
        addChatMessage(botResponse, 'bot');
      }

      themeButtons.forEach(button => {
        button.addEventListener('click', () => {
          currentTheme = button.dataset.theme;
          themeSelectionDiv.style.display = 'none';
          chatWindowDiv.style.display = 'flex';
          chatTitle.textContent = currentTheme;
          chatMessages.innerHTML = '';
          addChatMessage("Ol√°! Sobre o que voc√™ gostaria de saber dentro deste t√≥pico?", 'bot');
          chatInput.focus();
        });
      });

      backBtn.addEventListener('click', () => {
        chatWindowDiv.style.display = 'none';
        themeSelectionDiv.style.display = 'block';
        currentTheme = null;
      });

      sendBtn.addEventListener('click', () => handleChatSend(chatInput.value));
      chatInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          handleChatSend(chatInput.value);
        }
      });

      const profileQuizForm = document.getElementById('profile-quiz-form');
      profileQuizForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const resultDiv = document.getElementById('profile-quiz-result');
        const answers = new FormData(e.target);
        let score = 0;

        for (let value of answers.values()) {
          score += parseInt(value);
        }

        let profile = '',
          profileDescription = '',
          profileColorClass = '';

        if (score <= 16) {
          profile = 'Conservador';
          profileDescription = 'Voc√™ prioriza a seguran√ßa e a preserva√ß√£o do seu capital.';
          profileColorClass = 'profile-conservative';
        } else if (score <= 23) {
          profile = 'Moderado';
          profileDescription = 'Voc√™ busca um equil√≠brio entre seguran√ßa e rentabilidade.';
          profileColorClass = 'profile-moderate';
        } else {
          profile = 'Arrojado';
          profileDescription = 'Voc√™ tem alta toler√¢ncia ao risco e busca a m√°xima rentabilidade.';
          profileColorClass = 'profile-aggressive';
        }

        resultDiv.innerHTML = `<h4 class="text-xl font-bold mb-2">Seu Perfil: <span class="${profileColorClass}">${profile}</span></h4><p>${profileDescription}</p>`;
        resultDiv.style.display = 'block';
      });

      document.querySelectorAll('.interactive-checklist').forEach(checklist => {
        const checkboxes = checklist.querySelectorAll('input[type="checkbox"]');
        const progressBar = checklist.querySelector('.progress-bar-fill');
        const totalSteps = checkboxes.length;

        function updateProgress() {
          const checkedSteps = checklist.querySelectorAll('input[type="checkbox"]:checked').length;
          const percentage = (checkedSteps / totalSteps) * 100;
          progressBar.style.width = percentage + '%';
        }

        checkboxes.forEach(checkbox => {
          checkbox.addEventListener('change', () => {
            checkbox.closest('label').classList.toggle('completed', checkbox.checked);
            updateProgress();
          });
        });

        updateProgress();
      });
    }

    // --- ANIMA√á√ÉO DE FUNDO GLOBAL ---
    const canvas = document.getElementById('animated-background');
    const ctx = canvas.getContext('2d');
    let particles = [];

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resizeCanvas();

    class Particle {
      constructor(x, y, directionX, directionY, size, color) {
        this.x = x;
        this.y = y;
        this.directionX = directionX;
        this.directionY = directionY;
        this.size = size;
        this.color = color;
      }
      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2, false);
        ctx.fillStyle = this.color;
        ctx.fill();
      }
      update() {
        if (this.x > canvas.width || this.x < 0) this.directionX = -this.directionX;
        if (this.y > canvas.height || this.y < 0) this.directionY = -this.directionY;
        this.x += this.directionX;
        this.y += this.directionY;
        this.draw();
      }
    }

    function init() {
      particles = [];
      let numberOfParticles = (canvas.height * canvas.width) / 9000;
      for (let i = 0; i < numberOfParticles; i++) {
        let size = (Math.random() * 2) + 1;
        let x = (Math.random() * ((innerWidth - size * 2) - (size * 2)) + size * 2);
        let y = (Math.random() * ((innerHeight - size * 2) - (size * 2)) + size * 2);
        let directionX = (Math.random() * .4) - .2;
        let directionY = (Math.random() * .4) - .2;
        particles.push(new Particle(x, y, directionX, directionY, size, 'rgba(173, 216, 230, 0.5)'));
      }
    }

    function connect() {
      let opacityValue = 1;
      for (let a = 0; a < particles.length; a++) {
        for (let b = a; b < particles.length; b++) {
          let distance = ((particles[a].x - particles[b].x) * (particles[a].x - particles[b].x)) +
            ((particles[a].y - particles[b].y) * (particles[a].y - particles[b].y));
          if (distance < (canvas.width / 7) * (canvas.height / 7)) {
            opacityValue = 1 - (distance / 20000);
            ctx.strokeStyle = `rgba(173, 216, 230, ${opacityValue})`;
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(particles[a].x, particles[a].y);
            ctx.lineTo(particles[b].x, particles[b].y);
            ctx.stroke();
          }
        }
      }
    }

    function animate() {
      requestAnimationFrame(animate);
      ctx.clearRect(0, 0, innerWidth, innerHeight);
      particles.forEach(p => p.update());
      connect();
    }

    window.addEventListener('resize', () => {
      resizeCanvas();
      init();
    });

    init();
    animate();
  </script>

  <style>
    :root {
      --dark-blue: #2c3e50;
      --br-green: #009B3A;
      --br-yellow: #FFDF00;
      --us-blue: #0A3161;
      --us-red: #B31942;
      --crypto-yellow: #F7931A;
      --crypto-black: #333333;
      --glass-bg: rgba(15, 15, 25, 0.5);
      --glass-border: rgba(255, 255, 255, 0.1);
      --text-light: #f0f0f0;
      --success-color: #28a745;
      --danger-color: #dc3545;
      --warning-color: #ffc107;
      --gemini-purple: #8e44ad;
    }

    html {
      scroll-behavior: smooth;
    }

    #animated-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

    body {
      font-family: 'Inter', Arial, sans-serif;
      margin: 0;
      color: var(--text-light);
      background-color: #020412;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow-y: auto;
    }

    #login-screen {
      display: flex;
      justify-content: center;
      align-items: center;
      position: fixed;
      inset: 0;
      z-index: 1002;
      background-color: #020412;
    }

    .login-box {
      background-color: rgba(0, 0, 0, 0.5);
      padding: 40px;
      border-radius: 15px;
      text-align: center;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      width: 100%;
      max-width: 400px;
      box-sizing: border-box;
      margin: 1rem;
    }

    .login-box input,
    .login-box button {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 8px;
      font-size: 1em;
      box-sizing: border-box;
    }

    .login-box input {
      border: 1px solid #555;
      background-color: #222;
      color: white;
    }

    .login-box button {
      border: none;
      color: white;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    #sign-in-button {
      background-color: var(--gemini-purple);
    }

    .message {
      margin-top: 15px;
      font-weight: bold;
      display: none;
      padding: 10px;
      border-radius: 5px;
    }

    .message.error {
      background-color: rgba(220, 53, 69, 0.5);
    }

    .message.success {
      background-color: rgba(40, 167, 69, 0.5);
    }

    #ebook-content {
      display: none;
      width: 100%;
      max-width: 960px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }

    #auth-container {
      position: fixed;
      top: 15px;
      right: 20px;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 8px 15px;
      border-radius: 20px;
      display: none;
      align-items: center;
      gap: 15px;
      z-index: 1001;
      backdrop-filter: blur(5px);
    }

    #sign-out-button {
      background: var(--danger-color);
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }

    /* ESTILOS DAS GAVETAS (ACCORDION) */
    #main-content details {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      margin-bottom: 1rem;
      transition: all 0.3s ease;
    }

    #main-content details:hover {
      border-color: rgba(255, 255, 255, 0.3);
    }

    #main-content details[open] {
      background: rgba(15, 15, 25, 0.7);
    }

    #main-content summary {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 1rem 1.5rem;
      cursor: pointer;
      font-size: 1.5em;
      font-weight: bold;
      color: var(--text-light);
      list-style: none;
      /* Remove a seta padr√£o */
      font-family: 'Poppins', sans-serif;
      transition: background-color 0.2s;
    }

    #main-content summary::-webkit-details-marker {
      display: none;
      /* Oculta seta no Chrome/Safari */
    }

    #main-content summary:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }

    #main-content summary::after {
      /* √çcone personalizado '+' e '-' */
      content: '+';
      margin-left: auto;
      font-size: 2em;
      font-weight: 200;
      transition: transform 0.3s ease;
    }

    #main-content details[open]>summary::after {
      content: '‚àí';
      transform: rotate(180deg);
    }

    .drawer-content {
      padding: 0 1.5rem 1.5rem 1.5rem;
      border-top: 1px solid var(--glass-border);
    }

    .title-flag {
      height: 1.2em;
      width: auto;
      border-radius: 4px;
    }

    /* Cores tem√°ticas para as gavetas */
    summary.us-theme {
      color: #a9c7ff;
    }

    summary.br-theme {
      color: #a6ffcb;
    }

    summary.crypto-theme {
      color: var(--crypto-yellow);
    }

    summary.profile-theme {
      color: #6dd5ed;
    }

    summary.quiz-theme {
      color: var(--gemini-purple);
    }

    /* Estilos do conte√∫do interno */
    .content-section {
      background: none;
      border: none;
      padding: 0;
      margin: 0;
      box-shadow: none;
      backdrop-filter: none;
    }

    .content-section h3 {
      font-size: 1.6em;
      margin-top: 30px;
      padding-bottom: 10px;
      border-bottom: 2px solid;
    }

    #mercado-americano h3 {
      border-color: var(--us-red);
    }

    #mercado-brasileiro h3 {
      border-color: var(--br-yellow);
    }

    #criptoativos h3 {
      border-color: var(--crypto-yellow);
    }

    /* Outros estilos que permanecem */
    code {
      font-family: 'Roboto Mono', monospace;
      background-color: rgba(255, 255, 255, 0.1);
      padding: 3px 6px;
      border-radius: 4px;
    }

    .video-embed-container,
    .audio-player-container,
    .interactive-checklist,
    .quiz-container,
    .metrics-grid {
      margin-top: 30px;
    }

    /* Estilos do Chatbot (sem altera√ß√µes significativas) */
    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(142, 68, 173, 0.7);
      }
      100% {
        box-shadow: 0 0 0 15px rgba(142, 68, 173, 0);
      }
    }

    #chat-fab {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background-color: var(--gemini-purple);
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
      cursor: pointer;
      z-index: 999;
      animation: pulse 2s infinite;
    }

    #chat-popup {
      position: fixed;
      bottom: 100px;
      right: 30px;
      width: 400px;
      max-width: 90vw;
      height: 600px;
      max-height: 75vh;
      background: rgba(10, 25, 47, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      display: none;
      flex-direction: column;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease, transform 0.3s ease;
      transform: translateY(10px);
    }

    #chat-popup.show-chat {
      display: flex;
      opacity: 1;
      transform: translateY(0);
    }

    /* Responsividade */
    @media (max-width: 800px) {
      body {
        align-items: flex-start;
      }
      #ebook-content {
        padding: 1rem 0.5rem;
      }
      #main-content summary {
        font-size: 1.2em;
        padding: 1rem;
      }
      .drawer-content {
        padding: 0 1rem 1rem 1rem;
      }
      .content-section h3 {
        font-size: 1.3em;
      }
      #chat-fab {
        width: 55px;
        height: 55px;
      }
      #chat-popup {
        inset: 10px;
        width: auto;
        height: auto;
        max-height: 85vh;
      }
    }
  </style>
</head>

<body>
  <canvas id="animated-background"></canvas>

  <div id="login-screen">
    <div class="login-box">
      <h2>Acesso ao E-book</h2>
      <p>Fa√ßa login para continuar.</p>
      <input type="email" id="email-input" placeholder="Digite o seu e-mail">
      <input type="password" id="password-input" placeholder="Digite a sua senha">
      <button id="sign-in-button">Entrar</button>
      <a href="#" id="forgot-password-link">Esqueceu a senha?</a>
      <p id="message" class="message"></p>
    </div>
  </div>

  <div id="ebook-content">
    <div id="auth-container">
      <span id="user-email"></span>
      <button id="sign-out-button">Sair</button>
    </div>

    <main id="main-content">
      <details>
        <summary class="us-theme"><img src="https://flagcdn.com/w40/us.png" class="title-flag" alt="Bandeira dos EUA"> Mercado Americano</summary>
        <div class="drawer-content">
          <section id="mercado-americano" class="content-section market-us">
            <div class="metrics-grid">
              <div class="metric-card">
                <div class="tradingview-widget-container" style="height:100%; width:100%">
                  <div class="tradingview-widget-container__widget" style="height:100%; width:100%"></div>
                  <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
                    { "symbol": "SPREADEX:SPX", "width": "100%", "height": "100%", "locale": "br", "dateRange": "12M", "colorTheme": "dark", "isTransparent": true, "autosize": true, "largeChartUrl": "" }
                  </script>
                </div>
              </div>
              <div class="metric-card">
                <div class="tradingview-widget-container" style="height:100%; width:100%">
                  <div class="tradingview-widget-container__widget" style="height:100%; width:100%"></div>
                  <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
                    { "symbol": "NASDAQ:NDX", "width": "100%", "height": "100%", "locale": "br", "dateRange": "12M", "colorTheme": "dark", "isTransparent": true, "autosize": true, "largeChartUrl": "" }
                  </script>
                </div>
              </div>
              <div class="metric-card">
                <div class="tradingview-widget-container" style="height:100%; width:100%">
                  <div class="tradingview-widget-container__widget" style="height:100%; width:100%"></div>
                  <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
                    { "symbol": "OANDA:XAUUSD", "width": "100%", "height": "100%", "locale": "br", "dateRange": "12M", "colorTheme": "dark", "isTransparent": true, "autosize": true, "largeChartUrl": "" }
                  </script>
                </div>
              </div>
            </div>
            <h3>Bolsas de Valores e √çndices</h3>
            <p>A bolsa de valores americana √© considerada a maior e mais influente do mundo...</p>
          </section>
        </div>
      </details>

      <details>
        <summary class="br-theme"><img src="https://flagcdn.com/w40/br.png" class="title-flag" alt="Bandeira do Brasil"> Mercado Brasileiro</summary>
        <div class="drawer-content">
          <section id="mercado-brasileiro" class="content-section market-br">
            <h3>Entendendo o Cen√°rio: O Mercado Brasileiro (B3)</h3>
            <p>No Brasil, o mercado de capitais √© centralizado na B3 (Brasil, Bolsa, Balc√£o)...</p>
          </section>
        </div>
      </details>

      <details>
        <summary class="crypto-theme">ü™ô Criptoativos</summary>
        <div class="drawer-content">
          <section id="criptoativos" class="content-section market-crypto">
            <h3>O que s√£o Criptomoedas?</h3>
            <p>Criptomoedas s√£o ativos digitais descentralizados...</p>
          </section>
        </div>
      </details>

      <details>
        <summary class="profile-theme">ü§î Perfil de Investidor</summary>
        <div class="drawer-content">
          <section id="perfil-investidor" class="content-section">
            <p>Entender a sua toler√¢ncia ao risco √© o primeiro passo...</p>
            <form id="profile-quiz-form" class="quiz-form">
              <button type="submit">Ver o Meu Perfil</button>
              <div id="profile-quiz-result" class="quiz-result" style="display: none;"></div>
            </form>
          </section>
        </div>
      </details>

      <details>
        <summary class="quiz-theme">‚úÖ Quiz de Aprendizagem</summary>
        <div class="drawer-content">
          <section id="quiz" class="content-section">
            <div class="quiz-container">
              <details>
                <summary class="us-theme">Prova: Mercado Americano üá∫üá∏</summary>
                <form class="quiz-form" id="quiz-americano">
                  <div class="questions-wrapper"></div><button type="submit">Verificar</button>
                  <div class="quiz-result"></div>
                </form>
              </details>
              </div>
          </section>
        </div>
      </details>

    </main>

    <div id="chat-fab">üí¨</div>

    <div id="chat-popup">
      </div>
  </div>

  <script type="module">
    import {
      GoogleGenerativeAI
    } from "https://esm.run/@google/generative-ai";

    const API_KEY = "AIzaSyBrBfHkU9wpED4nvWGN0R-mgYtzcusDnBU";
    const genAI = new GoogleGenerativeAI(API_KEY);
    const model = genAI.getGenerativeModel({
      model: "gemini-1.5-pro-latest"
    });

    window.genAI = genAI;
    window.geminiModel = model;
  </script>

</body>

</html>
